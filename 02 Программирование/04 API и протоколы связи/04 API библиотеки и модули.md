В разработке ПО очень распространено создание программных компонентов (модулей или библиотек), которые не являются самостоятельными, а предоставляют готовый инструментарий.

Класс, интерфейс или метод в программе, разрабатываемой на ООП языке может представлять собой API, который дает минимально необходимый набор функциональных возможностей.

Но кроме сущностей в коде, роль API выполняют **статические** и **динамические** библиотеки.

> **Статические библиотеки** — это заранее скомпилированные файлы с кодом на исходном языке, которые при сборке программы встраиваются в исполняемый файл

> **Динамические библиотеки** — это независимые скомпилированные библиотеки. Главная программа обращается к динамической библиотеке для получения необходимого функционала

> Библиотеки не имеют *точки входа*, поэтому они не могут использоваться самостоятельно

Статические библиотеки могут быть представлены различными типами файлов, которые будут содержать информацию, необходимую для использования этой библиотеки. К примеру, могут использоваться следующие типы файлов:

- `.lib` — используется в Windows
- `.a` — используется в UNIX и Linux системах для статических библиотек
- `.o` — объектные файлы, которые могут быть частью статической библиотеки
- `.pdb` — файлы отладочной информации, которые могут быть связаны со статическими библиотеками в Windows

Типы файлов динамических библиотек:

- `.dll` — в Windows
- `.so` — в Unix/Linux
- `.dylib` — в MacOS
- `.ocx` — расширение для библиотек ActiveX, которые также являются динамическими библиотеками и используются для создания компонентных приложений на Windows
- `.drv` — используется для драйверов устройств в Windows, которые могут быть реализованы как динамические библиотеки

#### Создание библиотеки на примере C\#

**Статическая библиотека**

По идее, также создается библиотека классов, компилируется, а потом в главном проекте просто создается ссылка на динамическую библиотеку. Затем при сборке главного проекта, библиотека классов линкуется с основной программой


[ILMerge](https://github.com/dotnet/ILMerge/blob/master/README.md "ILMerge")
[Netz](https://madebits.github.io/#r/msnet-netz-compressor.md)
You could use [modules](https://stackoverflow.com/questions/645728/what-is-a-module-in-net). You can link them into an assembly using the assembly linker, `al.exe`.


That's the downside of the .Net compilation process, you can't have things like static libraries and the header files that hold them together, everything is held in one big dll file and the only way to share information is to either build a common dll and reference it from other assemblies or to duplicate the code in each dll (possibly by copying/linking .cs files between projects).

Note that the 2nd way will declare different types, even though they have the same name. This will bite you on the ass with stuff like remoting (or anything that requires casting to specific shared interfaces between processes).


**Динамическая библиотека**

Нужно создать проект "библиотека классов .Net". Данный проект при компиляции преобразуется в динамическую библиотеку

### Сравнение типов библиотек

| Характеристика            | Статическая                                                          | Динамическая                                                                            |
| ------------------------- | -------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| Производительность        | обычно быстрее, т. к. код уже загружен в память                      | может быть медленнее                                                                    |
| Портативность             | требуется наличие исходной программы                                 | требуется исходная программа и все ее зависимости (дин. библиотеки)                     |
| Линковка                  | во время компиляции                                                  | во время выполнения                                                                     |
| Размер исполняемого файла | увеличивается                                                        | не увеличивается                                                                        |
| Обновление                | требует перекомпиляции всех зависимых программ                       | независимое от основной программы                                                       |
| Использование памяти      | загружается вся библиотека                                           | загружаются только используемые в данный момент части                                   |
| Совместное использование  | каждая программа копирует статическую библиотеку                     | разные программы могут обращаться одному и тому же файлу                                |
| Безопасность              | более безопасны, так как все зависимости включены в исполняемый файл | менее безопасны, так как библиотека может быть подменена для выполнения вредоносного ПО |
| Применение                | для небольших и высокопроизводительных программ                      | для приложений с множеством зависимостей                                                |

#API #Files #C-Sharp