Кодовая страница — это таблица, где каждому символу соответствует свой код.

Для эффективной работы с файлами и сетью во избежание избыточности (лишних нулей) в двухбайтовых символах Unicode применяют кодирование перед записью в файл или отправкой, а затем при считывании декодируют текст.

Unicode — это стандарт работы с текстовыми данными, не является кодировкой.

Список кодировок:
* UTF-7 — устаревший формат, который нужно избегать. На символ выделяется 7 бит.
* UTF-8 (Unicode Transformation Format) — по умолчанию для типов BinaryReader, StreamReader. Символ кодируется 1 байтом, 2, 3 или 4. [[Суррогатные пары]] записываются 4 байтами. Символы со значениями < 0x0080 занимают 1 байт; от 0x0080 до 0x07ff занимают 2 байта; от 0x0800 и выше занимают 3 байта (восточные символы)
* UTF-16 — каждый 16-разрядный символ кодируется в 2 байта или в 4 байта
* UTF-32 — все символы занимают 4 байта
* ASCII — символ < 0x0080 кодируется 1 байтом, другие символы игнорируются
* ASCII(7 bit)
* ANSI

UTF-16 & UTF-32 несовместимы с ASCII, в отличие от UTF-8.

## Кодовые страницы Windows

Существует 2 группы кодовых страниц Windows:
1) OEM — используется для не-юникодных DOS программ (Win32 Console)
2) ANSI — используется для не-юникодных Windows программ

>Байты любых данных (символов, чисел, других данных, представленных в виде массива байт) обычно хранятся начиная с младшего байта, заканчивая самым старшим. Такой порядок хранения называется `little endian`. Противоположный способ хранения (аналогично записи чисел в математике) называется `big endian`

## Класс Encoding

Абстрактный класс, предоставляющий возможности создавать объекты для кодирования и декодирования данных в заданных кодировках.

```csharp
string text = "Hi there!"

Encoding encodingUTF8 = Encoding.UTF8;

// Кодирование в массив байтов:
byte[] encodedBytes;
encodingUTF8.GetBytes(text);

// Показываем значение закодированных байтов
Console.WriteLine("Encoded bytes: " + BitConverter.ToString(encodedBytes));

String decodedString = encodingUTF8.GetString(encodedBytes);
```

```csharp
// Возвращает исходную строку
encodingUTF8.GetString(encodingUTF8.GetBytes("my LITTLE pony"));
```

Другие классы Encoding:
* ASCII (7 bit);
* UTF7;
* UTF8;
* Unicode — little endian UTF-16;
* BigEndianUnicode — big endian UTF-16;
* UTF32;
* Default — кодировка согласно настройкам ОС. Не рекомендуется использовать

Все эти классы стоит использовать из абстрактного класса Encoding, таким образом не создаются лишние экземпляры уже созданных классов.

Полезные методы классов кодирования:
* `Encoding.Convert(srcEncoding, destEncoding, bytes)`
* `конкретная_кодировка.GetHashCode()` — номер кодовой страницы

Если данные передаются порциями, нужно следить за их целостностью и не вызывать методы обработки к части данных. Если программа получит порцию 5 байт, то она декодирует только 2 символа и все полетит. Для этого существуют классы семейства (abstract) Decoder. Данные классы декодируют только те байты, которые можно декодировать, остальные сохраняются в памяти до следующего вызова метода.

Для кодирования аналогично используется Encoder

#C-Sharp #Char_types