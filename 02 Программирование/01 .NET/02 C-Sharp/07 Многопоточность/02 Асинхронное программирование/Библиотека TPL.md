
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –ø—Ä–∏ —Å—á–∏—Ç—ã–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î, –∏–∑ —Ñ–∞–π–ª–∞, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Ç. –¥. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–æ–π –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤.

**TPL (Task Parallel Library)** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **`System.Threading.Tasks`**. –í –æ—Å–Ω–æ–≤–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ª–µ–∂–∏—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—è **–∑–∞–¥–∞—á–∏** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

> –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏, –æ–Ω–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫—É, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–º—É –∏–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –ø—É–ª–∞ `ThreadPool`

–¢–∞–∫ –∫–∞–∫ –ª—é–±–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ ‚Äî —ç—Ç–æ —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫, —Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–≤–µ—Ä—à–∏—Ç –≤–µ—Å—å —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —ç—Ç–∏–º –ø–æ—Ç–æ–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.

–î–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ TPL –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —É–ø—Ä–æ—â–∞—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å –Ω–µ–π.

**`Task`** ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å –ø—Ä–æ—Ü–µ–¥—É—Ä (`void`)
**`Task<T>`** ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å –º–µ—Ç–æ–¥–æ–≤ —Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

* –í –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö —ç—Ç–æ –ø–æ–Ω—è—Ç–∏–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Future** –∏–ª–∏ **Promise**.

> `Task` ‚Äî —ç—Ç–æ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è), –∫–æ—Ç–æ—Ä–∞—è **–±—É–¥–µ—Ç** —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –¢–æ –µ—Å—Ç—å –∫–æ–≥–¥–∞-—Ç–æ –≤ –±—É–¥—É—â–µ–º `Task` –±—É–¥–µ—Ç –∏–º–µ–Ω—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã:

```csharp
Task(Action a);
Task(Action a, CancellationToken ct);
```

## –ö–ª–∞—Å—Å `Task`

### –ú–µ—Ç–æ–¥—ã

| –ú–µ—Ç–æ–¥                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                                                                                  |
| ------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`Start()`**                                                 | –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏                                                                                                                                                                               |
| **`Task.Factory.StartNew(Action a)`**                         | —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏; –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É                                                                                                                                                         |
| **`Task.Run(Action a)`**                                      | –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ **`Task.Factory.StartNew()`**                                                                                                                                                                  |
| **`Wait()`**                                                  | –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏. –ï—Å–ª–∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, —Ç–æ –æ–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —è–≤–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–æ–≥–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ–¥–æ–∂–¥–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏. |
| **`Task.WaitAll(Task[] tasks[, int ms])`**                    | –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á; **`ms`** ‚Äî–æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.                                                                                                  |
| **`Task.WaitAny(Task[] tasks[, int ms])`**                    | –æ–∂–∏–¥–∞–Ω–∏–µ –ª—é–±–æ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞                                                                                                                                                                                 |
| **`Task.WaitAsync(TimeSpan)`**                                | –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥—Ä—É–≥—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏, —É –∫–æ—Ç–æ—Ä–æ–π –±—ã–ª –≤—ã–∑–≤–∞–Ω —ç—Ç–æ—Ç –º–µ—Ç–æ–¥.                                                                                                             |
| **`Task.Delay(int milliseconds)`**                            | –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏—á–µ–≥–æ –Ω–µ –¥–∞–ª–∞–µ—Ç, –Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.                                                                                                                     |
| **`ContinueWith(Func<Task, TResult>)`**                       | –∫–æ–¥. –ó–∞–¥–∞—á–∞ –ê + –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏–π –∫–æ–¥ ‚Äî —ç—Ç–æ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞. –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –ê, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–∞–∫–æ–π-—Ç–æ                                                                                          |
| **`ContinueWhenAll<TResult>(Task[], Func<Task[], TResult>)`** | –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º—É –≤—ã—à–µ–º–µ—Ç–æ–¥—É, –Ω–æ –∂–¥–µ—Ç, –ø–æ–∫–∞ –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫–æ–¥.                                                                            |
| **`ContinueWhenAny(Task[], Action<Task>)`**                   | –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ –ª–æ–≥–∏–∫–µ –º–µ—Ç–æ–¥                                                                                                                                                                                  |
| **`Task.WhenAll(Task[])`**                                    | **–∑–∞–¥–∞—á–∞**, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ —Å–ø–∏—Å–∫–∞. –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä **`await`**                                                                                         |
| **`Task.WhenAny(Task[])`**                                    | –∫–æ–≥–¥–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞                                                                                                                                                                       |
| **`RunSynchronously()`**                                      | –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ                                                                                                                                                                                   |

### –°–≤–æ–π—Å—Ç–≤–∞

| –°–≤–æ–π—Å—Ç–≤–æ             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                       |
| -------------------- | -------------------------------------------------------------------------------------------------------------- |
| **`AsyncState`**     | –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏                                                                                        |
| **`Id`**             | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏                                                                                   |
| **`Task.CurrentId`** | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏                                                                                   |
| **`Exception`**      | –æ–±—ä–µ–∫—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–æ–∑–Ω–∏–∫—à–µ–≥–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏                                                             |
| **`Status`**         | —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –≤ –≤–∏–¥–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è **`TaskStatus`** (–∏–Ω—Ñ-–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç–∏,  –æ—Ç–º–µ–Ω–µ–Ω–Ω–æ—Å—Ç–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏ —Ç. –¥.) |

## –ö–ª–∞—Å—Å `Task<T>`

–°–≤–æ–π—Å—Ç–≤–∞ **`Task<T>`**:

| –°–≤–æ–π—Å—Ç–≤–æ     | –û–ø–∏—Å–∞–Ω–∏–µ                |
| ------------ | ----------------------- |
| **`Result`** | "–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ" |

> –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫. –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ (**`Tasks`**) –∫–æ–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–∞—Ä—É—à–µ–Ω–∏—é –ª–æ–≥–∏–∫–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–æ–±–∞—Ä–∞—Ç—å—Å—è

–ú–∏—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –ú–∏—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±–µ—â–∞–Ω–∏–π ‚Äî —ç—Ç–æ –∑–∞–¥–∞—á–∏. Task-–∏ ‚Äî —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

–ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ.

==??? –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ **`Task<TResult>`** –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–∂–∏–¥–∞–Ω–∏–µ, –ø–æ–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω.==

–ü—Ä–∏–º–µ—Ä:

```csharp
// –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
void Task AsyncMethod()
{
    var task = Task.Delay(2000);
    task.Wait();
    //code..
}

static void Main()
{
    var t = AsyncMethod();
    Console.WriteLine("Line 2");
    Console.WriteLine("Line 3");
    Console.WriteLine("Line 4");
}
```

–ï—Å—Ç—å –º–µ—Ç–æ–¥ **`Main()`** & **`AsyncMethod()`**, –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. –í –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π **`t`** –Ω–∞—Ö–æ–¥–∏—Ç—Å—è "–æ–±–µ—â–∞–Ω–∏–µ" —Ç–æ–≥–æ, —á—Ç–æ **`AsyncMethod()`** –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∏ –≤–µ—Ä–Ω–µ—Ç –∫–∞–∫–æ–µ-—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –µ–≥–æ –Ω–µ—Ç), –æ—Ç—Å—é–¥–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è **Promise** –∏ **Future** –∫–∞–∫ –∞–Ω–∞–ª–æ–≥–∏ **Task**. –¢–µ–º –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è 2-—è, 3-—è –∏ 4-—è —Å—Ç—Ä–æ—á–∫–∏ –∫–æ–¥–∞, –ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞. –ü—Ä–∏ —ç—Ç–æ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥, –º–æ–∂–µ—Ç —Ä–∞–Ω—å—à–µ, –º–æ–∂–µ—Ç –≥–æ—Ä–æ–∑–¥–æ –ø–æ–∑–∂–µ —Å–∞–º–æ–≥–æ **`Main()`**, –∞ –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤—Å—Ç–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞: "–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â–µ –Ω–µ—Ç?". –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∂–¥–∞—Ç—å ü§∑‚Äç‚ôÄÔ∏è

```csharp
var t1 = Task<int>.Run(() => GenerateInt(10));
var t2 = t1.ContinueWith(t1 => t.Result * 10);

//t2.Wait();
Console.WriteLine(t2.Result);

int GenerateInt(int x)
{
	Task.Delay(3000).Wait();
	return 2 * x;
}
// –û—Ç–≤–µ—Ç: 200
```

* –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π **`Thread.Sleep()`** –∏ –¥—Ä—É–≥–æ–π –Ω–µ–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥. –í–Ω—É—Ç—Ä–∏ `Task.Delay()` —Å–∫—Ä—ã—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Thread.Sleep()`

#### –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

```csharp
var outer = Task.Run(() =>
  var inner = Task.Run(some_action);
);

outer.Wait();
// End of Main
```

–í–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–Ω–µ—à–Ω–µ–π. –û–Ω–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø–æ—Ç–æ–∫ Main.

> –õ—é–±–æ–π –≤—ã–∑–æ–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –≤—ã–∑–æ–≤ `Task.Run()` –Ω–µ—è–≤–Ω–æ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å –Ω–æ–≤—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –¥–∞–∂–µ, –µ—Å–ª–∏ –º—ã –≤ –∫–æ–¥–µ –æ–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫–∏–∏, –∞ –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

## –û–ø–µ—Ä–∞—Ç–æ—Ä—ã `async` & `await`

–û–ø–µ—Ä–∞—Ç–æ—Ä **`async`**, –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, —Ç–æ –µ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–∞–¥–∞—á—É. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –æ–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –≤ –º–µ—Ç–æ–¥–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ **`await`** (–∞–Ω–∞–ª–æ–≥ `Task.Wait()`)

–û–ø–µ—Ä–∞—Ç–æ—Ä **`await`** ‚Äî —ç—Ç–æ –æ–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏. –ü–æ—Ç–æ–∫, –æ–∂–∏–¥–∞—é—â–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ `await`, –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è. –ö–æ–≥–¥–∞ –∏ –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞—é—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ–∂–¥–∞–ª—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–¥–∞—á–∏, –ø–æ—Ç–æ–∫ "–ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è" –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –¥–∞–ª—å—à–µ

–ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`await`**, —Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–µ –±—É–¥–µ—Ç, –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ, –ø–æ—ç—Ç–æ–º—É –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –¥–µ–ª–∞—Ç—å –º–µ—Ç–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`await`**

```csharp
async Task Method(){
  var task1 = Task.Run(some_action1);
  var task2 = Task.Run(some_action2);
  var task3 = Task.Run(background_work); // Method() –Ω–µ –∂–¥–µ—Ç —ç—Ç—É –∑–∞–¥–∞—á—É
  
  await task1;
  await task2;
}
```

>–°—Ç—Ä–æ–∫–∏ `var task1 = ...` & `var task2 = ...` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π —Å—Ä–∞–∑—É, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è, –ø–æ–∫–∞ –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –ø–æ–∫–∞ –º—ã –∂–¥–µ–º `task1`, `task2` —É–∂–µ –º–æ–≥–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è. –û–ø–µ—Ä–∞—Ç–æ—Ä `await`, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å–ª—É–∂–∏—Ç –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥:

```csharp
var t = Task<int>.Run(() => GenerateInt(10));

int GenerateInt(int x)
{
	Task.Delay(3000).Wait();
	return 2 * x;
}
```

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```csharp
var t = GenerateInt(10); // t.Type == Task

//—Ç–µ–ª–æ –∑–∞–¥–∞—á–∏ ‚Äî —ç—Ç–æ —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
//–∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω–æ–π
async Task<int> GenerateInt(int x)
{
  await Task.Delay(3000); // Wait();
  return 2 * x; // –∑–Ω–∞—á–µ–Ω–∏–µ –∏–¥–µ—Ç –≤ Task Result
}
// —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏: int
```

> **–í—ã–∑–æ–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏, –∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**

–æ–ø–µ—Ä–∞—Ç–æ—Ä **`async`** –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –º–µ—Ç–æ–¥–∞–º, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã:

* **`void`** ‚Äî –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å¬†`async`, –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç—Ä—É–¥–Ω–æ–æ—Ç–ª–æ–≤–∏–º—ã–º –æ—à–∏–±–∫–∞–º, –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`Task`. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, `void` –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* **`Task`** ‚Äî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ (`Created, WaitingToRun, Running, Cancelled, Faulted, etc.`)
* **`Task<T>`** ‚Äî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
* **`ValueTask`** ‚Äî –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–¥–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ¬†`Task`, –∫–æ–≥–¥–∞ –∏–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ –∑–∞–¥–∞—á–∞ —á–∞—Å—Ç–æ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    - –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Å—Ç–µ–∫–µ (stack), —É–º–µ–Ω—å—à–∞—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å¬†`Task`
* **`ValueTask<T>`** ‚Äî –ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω¬†`ValueTask`, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

–¢–∏–ø—ã **`void`** & **`Task`** –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, –∫–æ–≥–¥–∞ –≤ –º–µ—Ç–æ–¥–µ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ **`return`**.

**`void`** —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ, –∫–æ–≥–¥–∞ –¥—Ä—É–≥–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –Ω–µ—Ç (—Å–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞ –¥–µ–ª–µ–≥–∞—Ç–∞ **`Action`**), —Ç–∞–∫ –∫–∞–∫ –Ω–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –º–µ—Ç–æ–¥–∞–º **`void`** –æ–ø–µ—Ä–∞—Ç–æ—Ä **`await`**; –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ —Ç–∞–∫–∏—Ö –º–µ—Ç–æ–¥–∞—Ö —Ç—Ä—É–¥–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω—ã –≤–Ω–µ –º–µ—Ç–æ–¥–∞, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä—è–º–æ –≤ –º–µ—Ç–æ–¥–µ.

>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ **`in`**, **`ref`**, **`out`**

>–ò–º–µ–Ω–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–Ω—è—Ç–æ —Å –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º "Async"

```csharp
public static async Task DelayOperationAsync()
{
  BeforeCall();
  Task task = Task.Delay(1000); //–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
  AfterCall();
  await task;
  AfterAwait();
} 
```

### –†–∞–∑–ª–∏—á–∏—è Task & ValueTask

| `Task`                                                                                                          | `ValueTask`                                                                                                                                                                                                                                                           |
| --------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ                                            | –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–∏ –¥–µ–ª–∞—é—Ç —ç—Ç–æ —á–∞—Å—Ç–æ), –±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö                                                                                                     |
| –ü–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä `await` | –ü–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ –Ω–µ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `await`. –ü–æ—Å–∫–æ–ª—å–∫—É, –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, —Ç–æ –∫ –Ω–µ–º—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä                                                            |
| –í—ã–¥–µ–ª—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –Ω–∞ **–∫—É—á–µ**                                                                                   | –ú–æ–∂–µ—Ç –≤—ã–¥–µ–ª—è—Ç—å—Å—è –Ω–∞ —Å—Ç–µ–∫–µ, –æ–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –æ–±—ä–µ–∫—Ç `Task`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ValueTask` –≤ –ª—é–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö                                                                                          |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –ø—Ä–æ—Å—Ç–∞—è                                                                                            | –£—Å–ª–æ–∂–Ω–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ –∏–∑-–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–¥–∞—á–∏                                                                                                                                                                      |
| –û–±—ã—á–Ω–æ, –¥–∞–∂–µ, –µ—Å–ª–∏ `Task` –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Task`                              | –î–∞–∂–µ, –µ—Å–ª–∏ `ValueTask` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω—ã–º –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è. –¢–æ–≥–¥–∞ —É–∂–µ –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–æ–ª–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –±—ã–ª–æ —Å—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ |
| –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏                                                               | –í —Ü–µ–ª–æ–º –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å                                                                                                                                                                  |

### –î—Ä—É–≥–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

> –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **`task`** –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –º–µ—Ç–æ–¥–µ —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∫ –º–æ–º–µ–Ω—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ **`await`**, —Ç–æ —Ç–æ –æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–¥–∞ –º–µ—Ç–æ–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∫–æ–¥ –º–µ—Ç–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ **`task`** –≤ –Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ. –í —ç—Ç–æ–º –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, –æ–±—Ä–∞—â–∞—è—Å—å –∫ ID –ø–æ—Ç–æ–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —ç—Ç–∞–ø–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞

> –ï—Å–ª–∏ –æ–∂–∏–¥–∞–µ–º–∞—è –∑–∞–¥–∞—á–∞ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∫ –º–æ–º–µ–Ω—Ç—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ **`await`**, —Ç–æ –æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–¥–∞ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –æ–¥–∏–Ω —Ä–∞–∑, –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ **`await`** —Ç–∞–∫–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —É–∂–µ –Ω–µ –±—É–¥–µ—Ç

> –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –≤—ã–∑–≤–∞–Ω—ã. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –≤—ã–∑–æ–≤–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞

> –ï—Å–ª–∏ –º–µ—Ç–æ–¥ **`Main()`** –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1 –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –∏ —Å–∞–º **`Main()`** —è–≤–ª—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, —Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é, —Ç–∞–∫ –∫–∞–∫ –º–µ—Ç–æ–¥ **`Main()`** –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ

> –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –º–Ω–æ–≥–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ –∏ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á

–û–ø–µ—Ä–∞—Ç–æ—Ä **`await`** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏, –ø—Ä–∏ —ç—Ç–æ–º –æ–∂–∏–¥–∞–µ—Ç—Å—è –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:

```csharp
int res = await DoubleInt(10);

async Task<int> DoubleInt(int x)
{
  await Task.Delay(3000);
  return 2 * x;
}
```

–í –æ–±—â–µ–º, –Ω—É–∂–Ω–æ —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–æ–π —Ç–µ–º–µ –∏ –Ω–µ –º–µ—à–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥, –∏–Ω–∞—á–µ –º–æ–∂–Ω–æ —É—Ç–æ–Ω—É—Ç—å –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å—Ö–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –≤—Å–µ–≥–æ –ª–∏—à—å 2 –º–µ—Ç–æ–¥–∞: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π:

![[TPL Library callback scheme.png]]

–ö–∞–∫ –≤–∏–¥–Ω–æ, –∏–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞)

–î–∞–ª–µ–µ: [[–ö–ª–∞—Å—Å Parallel]]

#C-Sharp #C-Sharp/Threads/Async