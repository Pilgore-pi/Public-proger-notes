Назад: [[04 Проявление функциональной парадигмы|Функциональность в C#]]

**Сопоставление с образцом** — это механизм проверки выражения на совпадение с указанным шаблоном
Паттерн Matching присущ, в большей степени, функциональным языкам программирования. C# — мультипарадигмальный ЯП, он совмещает как ООП подход, так и функциональный.

Для сопоставления с образцом используется оператор `switch`. Стандартный оператор `switch` ничего не возвращает, а просто выполняет инструкции, оператор сопоставления с образцом **всегда возвращает значение**, поэтому если результат оператора `switch` является `void` (выполняются действия, а не возвращаются данные), то возникнет ошибка компиляции.

#### Синтаксис

```csharp
<variable> = <expression> switch {
	<sample1> => <expr1>,
	<sample2> => <expr2>...
}
```

**Пример использования**

```csharp
var state = temperature switch
{
	(> 32) and (< 212) => "liquid",
	< 32 => "solid",
	> 212 => "gas",
	32 => "solid / liquid transition",
	212 => "liquid / gas transition"
}
```

Следующий вариант не прокатит, так как тип должен выводиться до RunTime-а:

```csharp
object obj = "40";
var result = obj switch //Ошибка
{
	40 => 40,
	"40" => "40",
	_ => null
};
```

Конечно, можно было бы сказать что result будет типа object, но компилятор не выполняет подобного анализа

## Типы шаблонов

* Константа
* Шаблон, выполняющийся всегда
* Шаблон сравнения
* Логический шаблон
* Шаблон типа
* Шаблон is
* Шаблон создания переменной
* Шаблоны свойств
* Шаблон-котреж
* Шаблон списков

#### Шаблоны-константы

```csharp
40 => ...
"40" => ...
```

#### Шаблон, выполняющийся всегда

```csharp
_ => ...
```

#### Шаблоны сравнения

```csharp
< 40 => ...
> 40 => ...
== 40 => ...
!= 40 => ...
```

#### Логические шаблоны

```csharp
2 or 3 => ...
> 50 and < 100 => ...
not < 100 => ...
```

#### Шаблон типа

```csharp
object obj = "40";
object? result = obj switch
{
	double => 0.0,    // без объявления переменной
	int i => i * 100, // с объявлением
	
	// устаревший синтаксис, вместо этого используется шаблон свойства
	string s when s.Length < 3 => s + "00",
	_ => null
};
```

Можно объявить переменную через оператор отбрасывания, но зачем? `¯\_(ツ)_/¯`

#### Шаблон is

```csharp
//Синтаксис:
<variable> is <sample>

char c = 'i';
// Шаблон сравнения
bool IsLetter = c is (>= 'a' and <='z') or (>= 'a' and <='z');

bool IsNullable = c is Nullable<char>;

object obj = 0.1;
bool IsNumber = obj is int or double;
```

#### Шаблон создания переменной

```csharp
foo() is var w
// аналог var w = foo()
```

#### Шаблоны свойств

```csharp
RandomShape rs = new();
if (rs is Circle { Radius: 40, Area: 5024 })
	Console.WriteLine("It's a circle! No way! How could it happen?");

Car car = new(...);

car switch {
	{ Year: < 2000 } => "хлам",
	//{ Property: <sample> } => ...
	
	{ Year: < 2000, Type: "Truck" } => ...
	
	{ Year: < 2000, Owner: { Age: >= 18 and <= 60 } } => ...
	// ИЛИ
	{ Year: < 2000, Owner.Age: >= 18 and <= 60 } => ...
}
```

#### Шаблон-кортеж

```csharp
(x, y) switch
{
	(> 0, _) => ...,
	(< 0, < 0) => ...,
	(_, > 0) => ...
}
```

#### Шаблон-список

```csharp
[sample1, sample2, ..] => ...

// коллекция из 3х элементов соотв. 3-м вложенными шаблонам
getList() is [> 10, var x, _]...

//аналогично, но количество элементов неограничено
getList() is [> 10, var x, ..]...

//аналогично, но последний элемент не равен нулю
getList() is [> 10, var x, .., not 0]...
```

Символ многоточия в квадратных скобках может быть только один

Далее: [[06 Делегаты|Делегаты]]

#C-Sharp/Functions #Functional_programming #Pattern_matching