В FoxPro 2.6 отсутствуют синтаксические конструкции, позволяющие обрабатывать исключения, вместо этого используется событие **`ON ERROR`**. Это команда, которая вызывает другую команду при возникновении ошибок. В более новой версии Visual FoxPro была введена конструкция `TRY .. CATCH .. FINALLY` и оператор `THROW`

```foxpro
ON ERROR <COMMAND>

** Отключение обработчика события (по умолчанию)
ON ERROR
```

> Данная команда позволяет обрабатывать ошибки только во время выполнения программы (Runtime) 

> Событие **Error** происходит только, когда ошибка происходит в коде. Если обработчик события **Error** не содержит кода, обработки события **Error** не происходит. Если процедура `ON ERROR` уже находится в стеке вызовов, то события **Error** не происходит

| Функция | Описание |
|-|-|
| `ERROR()`      | Возвращает код возникшей ошибки |
| `MESSAGE([1])` | Возвращает сообщение об ошибке. Если передан аргумент `1`, то в сообщение будет содержать код, вызвавший ошибку |
| `LINENO([1])`  | Возвращает номер строки, в которой произошла ошибка. Если программа была прервана командой `CANCEL`, то возвращает `0`. Все пустые и закомментированные строки учитываются. Если передан аргумент `1`, то номер строки будет рассчитан относительно текущего модуля или процедуры |
| `PROGRAM([уровень_вложенности])` | Возвращает имя текущей программы. `PROGRAM()` эквивалентно `SYS(16)`. Параметр `уровень_вложенности` говорит о том, на каком уровне вложенности ограничивается контекст кода. Если `уровень_вложенности` = 0 или 1, то задается контекст на самом высоком уровне кода (стартовая программа). Если уровень вложенности указан, некорректно, то функция возвращает `NULL` |

```foxpro
** Функция формирования текста ошибки
function getError
    line = LINENO()
    if line = 0
        line = "? (program cancelled)"
    endif
    desc = "ERROR: " + CHR(13) + CHR(10)
    desc = desc + "    CODE=" + ERROR() + ' MESSAGE="' + MESSAGE() + '"' + CHR(13) + CHR(10)
    desc = desc + "    LINE=" + line + CHR(13) + CHR(10)
    desc = desc + "    ====================" + CHR(13) + CHR(10)
    desc = desc + "    " + MESSAGE(1) + CHR(13) + CHR(10)
    desc = desc + "    ====================" + CHR(13) + CHR(10)
return desc

procedure handleEr
    ? getError()
return

ON ERROR DO handleEr
```

#FoxPro
