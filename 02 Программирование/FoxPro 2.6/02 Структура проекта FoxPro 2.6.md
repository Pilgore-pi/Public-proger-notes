# Структура проекта FoxPro

[Источник](https://help.foxclub.ru/html/71acd830-031d-40ee-bc2b-a8d9452d0efc.htm)

> Понятие "контейнер базы данных" (`.dbc`) отсутствует в FoxPro 2.x и ниже

Создание проекта в командной панели по локальному пути:

```foxpro
SET DEFAULT TO X:\Foler\Subfolder\ProjectFolder\
CREATE PROJECT PROJ_NAME
```

Скрипт, автоматизирующий создание файлов проекта

```batch
@echo off
:: установка кодировки UTF-8
chcp 65001

:::: Локальные переменные ::::
setlocal
set project_dir=M:\
set source_folder=M:\Complex

cd %project_dir%

if not exist "%project_dir%" (
    echo project dir "%project_dir%" does not exist
    goto :End
)
xcopy "%source_folder%" "%project_dir%" /e /h /k /q /r /c /y

:End
pause
```

**Примечание:**

Выдача команды `SET PATH TO` без аргумента `Path`, востановит путь к каталогу по умолчанию. Используйте `SET DEFAULT`, чтобы задать каталог по умолчанию и `CURDIR()` для возврата имени текущего каталога, принятого по умолчанию.

SET PATH не применяйте в текущей датасессии; изменение пути по умолчанию используя команду SET PATH, даст эффект для всех датасессий.

SET PATH лимитирован длинной максимум 4095 символов.

| Команда | Описание |
|-|-|
| Set Default To | Задает текущую директорию. Команда SET DEFAULT изменяет стартовый каталог по-умолчанию на указанный каталог |
| Set Path To | Задает каталог для поиска файлов |
| Exclude | Исключает файл из проекта |
| Include | Включает файл в проект |
| Set Main | Устанавливает файл в качестве основной программы проекта |
| Edit Description | Открывает окно редактирования описания файла |
| Project Info | Отображает информацию о проекте |
| Errors | Отображает ошибки, возникшие при построении проекта |
| Build | Перестраивает проект |
| Refresh | Обновляет информацию в окне проекта |
| Clean Up Project | Упаковывает проект, очищая его от удаленных файлов |
| New | Создает новый файл, который после создания автоматически добавляется в проект |
| Add | Добавляет созданный ранее файл в проект |
| Modify | Модифицирует выбранный файл проекта |
| Remove | Удаляет файл из проекта |

Управление каталогами осуществляется командами Batch: `MD/MKDIR`, `RD/RMDIR`, `CD/CHDIR`

## Каталог проекта

- Файл проекта `.pjx`   : Метаданные проекта
- Файл приложения `.app`: Сгенерированное пользовательское приложение (это НЕ скомпилированная версия приложения)
- Файл `.pjt`: MEMO-ссылка на проект
- Файл `.err`: Текст описания ошибки проекта
- Файлы индексов:
    - `.idx`: Индекс по 1 полю таблицы
    - `.cdx`: Составной индекс по нескольким полям
    - `.dcx`: Индекс базы данных
- Каталог `.dbfs`: Набор таблиц базы данных
    - Файл `.dbf`: Таблица базы данных. Хранит информацию о типах полей, точности дробных чисел, о наличии индексов и др.
    - Файл `.fpt`: MEMO таблицы базы данных
- Каталог `menu` : Исходные файлы интерфейсов меню
    - Файл `.mnx`: Данные меню
    - Файл `.mnt`: MEMO меню
    - Файл `.mpr`: Автогенерируемый исходный код меню
- Каталог `prgs` : Модули проекта
    - **Файл `start.prg`**: Главная точка входа в программу
    - `.prg`: Текстовый файл с исходным кодом
- Каталог `reports`: Печатные макеты
- Каталог `screens`: Формы и обработчики событий форм
    - Файл `.fxp`  : Скомпилированное приложение формы
    - Файл `.scx`  : Данные формы
    - Файл `.sct`  : MEMO формы
    - Файл `.spr`  : Сгенерированный исходный код всех элементов формы

## Описание других форматов файлов

- Файл `.bak`: Общий (не относящийся именно к FoxPro) формат файла, хранящий данные для восстановления поврежденных файлов
- Файл `.tbk`: Данные для восстановления MEMO файла

### Табличные данные

Следующие файлы хранят данные в табличном виде и имеют одинаковый формат и структуру заголовка (метаданные):

- ~~Database (.dbc) — хранилище базы данных~~
- Form (.scx) — форма
- Menu (.mnx) — меню
- Project (.pjx) — проект
- Report (.frx) — печатный макет
- Table (.dbf) — таблица

Заголовок табличного файла содержит следующую информацию:

- Тип файла (указывается версия Fox или языка dBase)
- Дата изменения
- Количество записей
- Длина одной строки, включая флаг удаления
- ~~Путь к файлу контейнера базы данных (.dbc), связанному с данной таблицей, если он существует~~

## MEMO

> **MEMO-файл** — это поле, хранимое в отдельном файле

> **MEMO-поле** — переменная, ссылающаяся на MEMO-файл. Занимает 10 байт

MEMO файлы имеют заголовок:

|Байты|Поле|Описание|
|-|-|-|
|00-03|Тип|Тип данных MEMO поля, сигнатура блока (определяет тип данных, хранящихся в блоке). `0` – объект (для типов данных, ссылающихся на объект. Например, поле типа General); `1` – текст (для текстовых типов данных. Например, поле типа MEMO)|
|04-07|Длина блока|Длина одного блока MEMO файла в байтах|
|08...|Данные|Данные MEMO файла|

MEMO-файл может содержать несколько блоков данных. У каждого блока данных есть заголовок (8 байт), который хранит длину блока

### Редактирование файла MEMO

При редактировании файла MEMO, новые данные не заменяют старые, они дописываются в конец файла

Исключением является модификация при открытии таблицы эксклюзивно. В этом случае, при модификации содержимого, если новое значение помещается в уже выделенных блоках файла memo, то происходит замещение старой информации на том же месте

> Таким образом, при интенсивной модификации полей любого типа, содержимое которых хранится в файле memo (это поля типа `Memo`, `Memo (Binary)`, `Blob`, `General`) наблюдается лавинообразный рост размера этого файла. Причем большую часть его содержимого составляет уже не используемые старые данные. То, что было до внесения изменений.

Чтобы удалить уже не использующуюся старую информацию необходимо выполнить команду `PACK` или `PACK MEMO` в режиме эксклюзивного доступа
