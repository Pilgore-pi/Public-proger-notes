Ссылки:

- [Источник (Инфостарт)](https://infostart.ru/1c/articles/842751/)

### HTTP-сервис как объект метаданных

Структура объекта очень простая:

**HTTP-сервис**:

- Шаблон_URL_1
    - Метод_1
    - Метод_2...
- Шаблон_URL_2
    - Метод_1
    - Метод_2...
- Шаблон_URL_3...

Фактически объект представляет собой набор параметров и коллекцию шаблонов URL, где один шаблон содержит коллекцию обработчиков

- Все методы-обработчики определяются в модуле HTTP-сервиса

**Вкладка "Управление сеансами"**

Повторное использование сеансов:

- `Использовать автоматически` (по умолчанию)
- `Использовать`
- `Не использовать`

Время жизни сеанса: (ед. изм????)

### Структура URL HTTP сервиса

| N   | Стуктурный элемент                                            | Описание                                                                                                                                                                             |
| --- | ------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | IP или домен веб-сервера                                      |                                                                                                                                                                                      |
| 2   | Имя базы 1С                                                   | указывается при публикации                                                                                                                                                           |
| 3   | `hs`                                                          | признак обращения к HTTP-сервису                                                                                                                                                     |
| 4   | Имя ресурса, определяющее группу логически связанных ресурсов | В конфигураторе данный параметр задается в свойстве `Основные` `>` `Корневой URL`                                                                                                    |
| 5   | Имя ресурса, к которому будет выполняться обращение           | Относительный URL, указанный в запросе, будет использован для определения конкретного ресурса, к которому выполнялось обращение. Правило сопоставления задается в объекте Шаблон URL |
| 6   | Параметры запроса                                             |                                                                                                                                                                                      |

Пример:

```
http://host/base/hs/корневойURL/относительныйURL?ПараметрыЗапроса
```

### Шаблоны URL

Позволяют автоматически определять имена ресурсов в зависимости от параметров

> Строка шаблона URL ограничена тем же набором символов, что и идентификаторы языка 1С, но кроме этого можно использовать символы `/`, `{`, `}`, `*`

Скобки `{}` в шаблоне всегда должны включать в себя некоторый идентификатор встроенного языка

Пример с ИТС (17.2.2.3.2. Работа с документами):

```bsl
// Получение всех документов
Функция СписокGET(Запрос)
    Ответ = Новый HTTPСервисОтвет(200);
    Результат = "Расходная накладная, 1, 01.01.2014
                |Расходная накладная, 2, 01.01.2014";
                
    Ответ.УстановитьТелоИзСтроки(Результат);
    
    Возврат Ответ;
КонецФункции

// Получение документа с заданным номером
Функция ДокументGET(Запрос)
    Ответ = Новый HTTPСервисОтвет(200);
    Номер = Число(Запрос.ПараметрыURL.Получить("number"));
    
    Если Номер > 2 Тогда
        Ответ.КодСостояния = 404;
        Ответ.УстановитьТелоИзСтроки("Отсутствует документ с номером: " + Номер);
    Иначе
        Если Номер = 1 Тогда
            Ответ.УстановитьТелоИзСтроки("Расходная накладная, 1, 01.01.2014");
        Иначе
            Ответ.УстановитьТелоИзСтроки("Расходная накладная, 2, 01.01.2014");
        КонецЕсли;
    КонецЕсли;
    
    Возврат Ответ;
КонецФункции
```

Можно объединить 2 метода в один, добавив проверку параметра `"ИмяМетода"`

```bsl
Функция PrettyAPIGET(Запрос)
	Ответ = Новый HTTPСервисОтвет(200);
	
	ИмяМетода = Запрос.ПараметрыURL["ИмяМетода"];
	
	Если ИмяМетода = "Список" Тогда
    	
		Результат = "Расходная накладная, 1, 01.01.2014
                	|Расходная накладная, 2, 01.01.2014";
    
	ИначеЕсли ИмяМетода = "Документ" Тогда
		
		ПарНомер = Запрос.ПараметрыЗапроса.Получить("number");
		Номер = Число(?(ПарНомер=Неопределено,0,ПарНомер));
		
		Если Номер > 2 Тогда
	        Ответ.КодСостояния = 404;
	        Результат = "Отсутствует документ с номером: " + Номер;
    	    
	    Иначе
    	    
            Если Номер = 1 Тогда
	            Результат = "Расходная накладная, 1, 01.01.2014";
	        Иначе
	            Результат = "Расходная накладная, 2, 01.01.2014";
	        КонецЕсли;
	    КонецЕсли;
	    
	Иначе
    	
		 Ответ.КодСостояния = 405;
		 Результат = "Отсутствует Метод " + ИмяМетода;
    	
	КонецЕсли;	
	
	Ответ.УстановитьТелоИзСтроки(Результат,КодировкаТекста.UTF8);	
    
    // Необходимо для корректного отображения текста
	Ответ.Заголовки.Вставить("Content-Type","text/html; charset=utf-8");
	Возврат Ответ;
КонецФункции
```

Далее: [[06 Интерфейс OData|Интерфейс OData]]

#1С #Web #API #API/HTTP #1С/Интеграция