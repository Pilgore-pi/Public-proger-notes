https://infostart.ru/1c/articles/1777483/

> ??? можно ли создать COM соединение к другой базе, если она не запущена

----

```bsl
&НаСервере
Процедура ТестСОMНаСервере()
Соединение = ПодключитьсяКбазе();
Если ТипЗнч(Соединение) <> Тип("Неопределено") Тогда 
       ЗапросБПЗО = Соединение.NewObject("Запрос");
       ЗапросБПЗО.Текст = "ВЫБРАТЬ первые 15
                          |    СправочникПольз.Наименование КАК Наименование
                          |ИЗ
                          |    Cправочник.пользователи КАК СправочникПольз";
       Выборка = ЗапросБПЗО.Выполнить().выбрать(); 
       Пока Выборка.следующий() цикл
              Сообщить(Выборка.Номер);
       КонецЦикла;
КонецЕсли;
КонецПроцедуры
```

----


COM-соединения позволяют получать доступ к удаленным базам данных 1С и взаимодействовать с объектами из удаленной базы.

- При подключении к тонкому клиенту, будет вызван обработчик **[[12 Модули#Модуль приложения|"Модуль приложения"]]**
- При подключении к серверу, будет вызван обработчик **[[12 Модули#Модуль внешнего соединения|"Модуль внешнего соединения"]]**

> Технология COM доступна только на Windows. Чтобы обмениваться данными с БД на Linux, нужно применять другие подходы, такие как HTTP-сервисы

> COM-соединение устанавливается быстрее, чем OLE-соединение

Для подключения к файловой базе данных 1С через COM-соединение, необходимо знать 3 значения:

- Логин
- Пароль
- Путь к базе данных (можно посмотреть в разделе "О программе")

Для подключения к серверной базе нужно знать:

- Логин
- Пароль
- Имя сервера
- Имя базы данных

> Если COM connector не зарегестрирован в ОС, то нужно единоразово выполнить скрипт (Windows):

```batch
regsrv32 "C:Program Files\1cv8\8.3.26.1498\bin\comcntr.dll"
```

#Batch

Данная команда выполняет регистрацию `DLL`, создавая запись в реестре, что позволит использовать эту `DLL` в коде 1С. Команда предназначена для `DLL`, которые содержат компоненты ActiveX или COM-объекты.

#### Создание подключения

```bsl
&НаСервере
Процедура ПопыткаCOMСоединения()
    
    логин = объект.логин;
    пароль = объект.пароль;
    
    // Если файловая
    путьКБазе = объект.ПутьКБазе;
    
    // Если серверная
    имяСервера = объект.ИмяСервера;
    имяБД = объект.ИмяБД;
    
    попытка
        
        коннектор = новый ComОбъект("V83.ComConnector");
        
        // Если файловая
        удаленнаяБаза = коннектор.Connect(СтрШаблон(
            "File=""%1"";Usr=""%2"";Pwd=""%3"";",
            путьКБазе,
            логин,
            пароль
        ));
        
        // Если серверная
        удаленнаяБаза = коннектор.Connect(СтрШаблон(
            "Srvr=""%1"";Ref=""%2"";Usr=""%3"";Pwd=""%4"";",
            имяСервера,
            имяБД,
            логин,
            пароль
        ));
        
        СообщитьПользователю("COM-соединение успешно")
        
        // Обмен данными
        ОбработатьПолученныеДанные();
        
    исключение
        
        СообщитьПользователю("Ошибка при создании COM-соединения!")
        
    конецПопытки;
    
КонецПроцедуры
```

#### Обработка входящих данных

```bsl
&НаСервере
Процедура ОбработатьПолученныеДанные(удаленнаяБаза)
    
    изделия = удаленнаяБаза.Справочники.Изделия.Выбрать();
    
    // Запись информации об изделиях в текущую базу
    Пока изделия.Следующий() цикл
        
        новоеИзделие = Справочники.Изделия.СоздатьЭлемент();
        новоеИзделие.Вид = Перечисления.ВидыИзделий.Инструмент;
        новоеИзделие.Код = удаленнаяБаза.XMLСтрока(изделия.Код);
        новоеИзделие.Ответственный = удаленнаяБаза.XMLСтрока(изделия.Ответственный);
        новоеИзделие.Записать();
        
    конецЦикла;
    
КонецПроцедуры
```

#### Посылка исходящих данных

```bsl
&НаСервере
Процедура ПослатьДанные(удаленнаяБаза)
    
    // КАК посылать данные и создавать новые объекты в удаленной базе
    
КонецПроцедуры
```

чтобы создать в подключении новый объект, аналогично оператору Новый ИмяТипа(А1, А2), мы должны писать:

```bsl
Подключение.NewObject("ИмяТипа", А1, А2);
```

Вычислить произвольное выражение можно с помощью функции Eval:

```bsl
Подключение.Eval("1+2");
```

#1С #API/COM #1С/Интеграция
