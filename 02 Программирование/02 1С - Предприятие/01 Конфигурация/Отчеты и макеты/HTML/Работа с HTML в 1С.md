
В 1С есть специальный редактор HTML документов. В его возможности входит:

- Редактирование и форматирование текста
- Вставка и настройка таблиц
- Создание гиперссылок
- Вставка разделительных линий
- Вставка картинок

Однако причин использовать этот редактор нет, так как любой другой редактор HTML лучше, чем редактор 1C

Для отображения HTML документов на формах используется элемент управления "**Поле HTML документа**", которое получает данные из переменной с типом **Строка**, в которой должен находится весь HTML код документа

> HTML документы хранятся в макетах HTML, которые могут быть **подчиненными** или **общими**

Чтобы правильно инициализировать строковую переменную, из которой будет браться информация для поля HTML, необходимо получить текст макета:

```bsl
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЭтаОбработка = РеквизитФормыВЗначение("Объект");
    
    // МакетHTML - это реквизит формы типа Строка
	МакетHTML = ЭтаОбработка.ПолучитьМакет("TreeHTML").ПолучитьТекст();
КонецПроцедуры
```

Для работы с историей просмотренных страниц можно использовать методы `Вперед()` и `Назад()`:

```bsl
элементы.ПолеHTML.Вперед();
элементы.ПолеHTML.Назад();
```

У поля формы вида "Поле HTML документа" существуют следующие события:

- `ПриНажатии`: Возникает при нажатии (с помощью мыши или клавиатуры) на любой элемент внутри окна поля HTML-документа
- `ДокументСформирован`: Возникает, когда HTML-документ построен и готов к использованию
- `ПриИзменении`
- `ПриЗаписи`

У HTML документа есть свойство **`Документ`** (`document`), которое дает доступ к объектной модели HTML, через которую можно обращаться ко всем элементам HTML и изменять или считывать их значения

Пример.

```html
<html>
    <head>
        <title>Анкета</title>
    </head>
    <body>
        <form name=’inputForm’ action=’input.asp’>
            <table>
                <tr>
                    <td>Организация</td>
                    <td>
                        <input type=text name=’organization’>
                    </td>
                </tr>
                <tr>
                    <td>Кому</td>
                    <td>
                        <input type=text name=’to’>
                    </td>
                </tr>
                <tr>
                    <td>Пожелание</td>
                    <td>
                        <input type=text name=’message’>
                    </td>
                </tr>
                <tr>
                    <td colspan=2 align=center>
                        <input type=submit name=’ok’ value=’Отправить’>
                    </td>
                </tr>
            </table>
        </form>
    </body>
</html>
```

Упрощенно объектную модель можно представить следующим образом:

==УЗНАТЬ СТРУКТУРУ В RUNTIME ЧЕРЕЗ ОТЛАДЧИК==

- `document`
    - `body`
    - `forms[inputForm]` (коллекция)
        - `text (message)`
        - `text (organization)`
        - `text (to)`
    - `URL` — адрес HTML

Пример обработки в коде 1С:

```bsl
Док = Элементы.ПолеHTML.Документ;
Док.forms[″inputForm″].organization.Value = ″ООО Вперед″;
Док.forms[″inputForm″].to.Value = ″директору″;
Док.forms[″inputForm″].message.Value = ″здоровья и счастья!″;
```

#### Полная структура свойства "Документ" поля HTML

Данное свойство доступно только `&НаКлиенте`, так как оно принадлежит элементу управления формы "поле HTML документа"

| Свойство                                  | Значение              | Тип           |
| ----------------------------------------- | --------------------- | ------------- |
| ATTRIBUTE_NODE                            | 2                     | Число         |
| CDATA_SECTION_NODE                        | 4                     | Число         |
| COMMENT_NODE                              | 8                     | Число         |
| DOCUMENT_FRAGMENT_NODE                    | 11                    | Число         |
| DOCUMENT_NODE                             | 9                     | Число         |
| DOCUMENT_POSITION_CONTAINED_BY            | 16                    | Число         |
| DOCUMENT_POSITION_CONTAINS                | 8                     | Число         |
| DOCUMENT_POSITION_DISCONNECTED            | 1                     | Число         |
| DOCUMENT_POSITION_FOLLOWING               | 4                     | Число         |
| DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC | 32                    | Число         |
| DOCUMENT_POSITION_PRECEDING               | 2                     | Число         |
| DOCUMENT_TYPE_NODE                        | 10                    | Число         |
| ELEMENT_NODE                              | 1                     | Число         |
| ENTITY_NODE                               | 6                     | Число         |
| ENTITY_REFERENCE_NODE                     | 5                     | Число         |
| NOTATION_NODE                             | 12                    | Число         |
| PROCESSING_INSTRUCTION_NODE               | 7                     | Число         |
| TEXT_NODE                                 | 3                     | Число         |
| **URL**                                   | "about:blank"         | Строка        |
| activeElement                             | ВнешнийОбъект         | ВнешнийОбъект |
| alinkColor                                | ""                    | Строка        |
| anchors                                   | ВнешнийОбъект         | ВнешнийОбъект |
| applets                                   | ВнешнийОбъект         | ВнешнийОбъект |
| baseURI                                   | "about:blank"         | Строка        |
| bgColor                                   | ""                    | Строка        |
| body                                      | ВнешнийОбъект         | ВнешнийОбъект |
| characterSet                              | "windows-1252"        | Строка        |
| charset                                   | "windows-1252"        | Строка        |
| childElementCount                         | 1                     | Число         |
| childNodes                                | ВнешнийОбъект         | ВнешнийОбъект |
| children                                  | ВнешнийОбъект         | ВнешнийОбъект |
| compatMode                                | "BackCompat"          | Строка        |
| contentType                               | "text/html"           | Строка        |
| cookie                                    | ""                    | Строка        |
| currentScript                             |                       | Неопределено  |
| defaultView                               | ВнешнийОбъект         | ВнешнийОбъект |
| designMode                                | "off"                 | Строка        |
| dir                                       | ""                    | Строка        |
| doctype                                   |                       | Неопределено  |
| **documentElement**                       | ВнешнийОбъект         | ВнешнийОбъект |
| documentURI                               | "about:blank"         | Строка        |
| domain                                    | ""                    | Строка        |
| embeds                                    | ВнешнийОбъект         | ВнешнийОбъект |
| fgColor                                   | ""                    | Строка        |
| firstChild                                | ВнешнийОбъект         | ВнешнийОбъект |
| firstElementChild                         | ВнешнийОбъект         | ВнешнийОбъект |
| fonts                                     | ВнешнийОбъект         | ВнешнийОбъект |
| forms                                     | ВнешнийОбъект         | ВнешнийОбъект |
| head                                      | ВнешнийОбъект         | ВнешнийОбъект |
| hidden                                    | Ложь                  | Булево        |
| images                                    | ВнешнийОбъект         | ВнешнийОбъект |
| implementation                            | ВнешнийОбъект         | ВнешнийОбъект |
| inputEncoding                             | "windows-1252"        | Строка        |
| lastChild                                 | ВнешнийОбъект         | ВнешнийОбъект |
| lastElementChild                          | ВнешнийОбъект         | ВнешнийОбъект |
| lastModified                              | "01/01/2025 15:43:54" | Строка        |
| linkColor                                 | ""                    | Строка        |
| links                                     | ВнешнийОбъект         | ВнешнийОбъект |
| location                                  | ВнешнийОбъект         | ВнешнийОбъект |
| nextSibling                               |                       | Неопределено  |
| nodeName                                  | "#document"           | Строка        |
| nodeType                                  | 9                     | Число         |
| nodeValue                                 |                       | Неопределено  |
| onabort                                   |                       | Неопределено  |
| onanimationend                            |                       | Неопределено  |
| onanimationiteration                      |                       | Неопределено  |
| onanimationstart                          |                       | Неопределено  |
| onblur                                    |                       | Неопределено  |
| oncanplay                                 |                       | Неопределено  |
| oncanplaythrough                          |                       | Неопределено  |
| onchange                                  |                       | Неопределено  |
| onclick                                   |                       | Неопределено  |
| oncontextmenu                             |                       | Неопределено  |
| oncopy                                    |                       | Неопределено  |
| oncuechange                               |                       | Неопределено  |
| oncut                                     |                       | Неопределено  |
| ondblclick                                |                       | Неопределено  |
| ondrag                                    |                       | Неопределено  |
| ondragend                                 |                       | Неопределено  |
| ondragenter                               |                       | Неопределено  |
| ondragleave                               |                       | Неопределено  |
| ondragover                                |                       | Неопределено  |
| ondragstart                               |                       | Неопределено  |
| ondrop                                    |                       | Неопределено  |
| ondurationchange                          |                       | Неопределено  |
| onemptied                                 |                       | Неопределено  |
| onended                                   |                       | Неопределено  |
| onerror                                   |                       | Неопределено  |
| onfocus                                   |                       | Неопределено  |
| oninput                                   |                       | Неопределено  |
| oninvalid                                 |                       | Неопределено  |
| onkeydown                                 |                       | Неопределено  |
| onkeypress                                |                       | Неопределено  |
| onkeyup                                   |                       | Неопределено  |
| onload                                    |                       | Неопределено  |
| onloadeddata                              |                       | Неопределено  |
| onloadedmetadata                          |                       | Неопределено  |
| onloadstart                               |                       | Неопределено  |
| onmousedown                               |                       | Неопределено  |
| onmouseenter                              |                       | Неопределено  |
| onmouseleave                              |                       | Неопределено  |
| onmousemove                               |                       | Неопределено  |
| onmouseout                                |                       | Неопределено  |
| onmouseover                               |                       | Неопределено  |
| onmouseup                                 |                       | Неопределено  |
| onmousewheel                              |                       | Неопределено  |
| onpaste                                   |                       | Неопределено  |
| onpause                                   |                       | Неопределено  |
| onplay                                    |                       | Неопределено  |
| onplaying                                 |                       | Неопределено  |
| onprogress                                |                       | Неопределено  |
| onratechange                              |                       | Неопределено  |
| onreadystatechange                        |                       | Неопределено  |
| onrejectionhandled                        |                       | Неопределено  |
| onreset                                   |                       | Неопределено  |
| onresize                                  |                       | Неопределено  |
| onscroll                                  |                       | Неопределено  |
| onseeked                                  |                       | Неопределено  |
| onseeking                                 |                       | Неопределено  |
| onselect                                  |                       | Неопределено  |
| onstalled                                 |                       | Неопределено  |
| onsubmit                                  |                       | Неопределено  |
| onsuspend                                 |                       | Неопределено  |
| ontimeupdate                              |                       | Неопределено  |
| ontoggle                                  |                       | Неопределено  |
| ontransitionend                           |                       | Неопределено  |
| onunhandledrejection                      |                       | Неопределено  |
| onvisibilitychange                        |                       | Неопределено  |
| onvolumechange                            |                       | Неопределено  |
| onwaiting                                 |                       | Неопределено  |
| origin                                    | "null"                | Строка        |
| ownerDocument                             |                       | Неопределено  |
| parentElement                             |                       | Неопределено  |
| parentNode                                |                       | Неопределено  |
| plugins                                   | ВнешнийОбъект         | ВнешнийОбъект |
| preferredStylesheetSet                    |                       | Неопределено  |
| previousSibling                           |                       | Неопределено  |
| readyState                                | "complete"            | Строка        |
| referrer                                  | ""                    | Строка        |
| rootElement                               |                       | Неопределено  |
| scripts                                   | ВнешнийОбъект         | ВнешнийОбъект |
| scrollingElement                          | ВнешнийОбъект         | ВнешнийОбъект |
| selectedStylesheetSet                     |                       | Неопределено  |
| styleSheets                               | ВнешнийОбъект         | ВнешнийОбъект |
| textContent                               |                       | Неопределено  |
| title                                     | ""                    | Строка        |
| visibilityState                           | "visible"             | Строка        |
| vlinkColor                                | ""                    | Строка        |
| webkitCurrentFullScreenElement            |                       | Неопределено  |
| webkitFullScreenKeyboardInputAllowed      | Ложь                  | Булево        |
| webkitFullscreenElement                   |                       | Неопределено  |
| webkitFullscreenEnabled                   | Истина                | Булево        |
| webkitIsFullScreen                        | Ложь                  | Булево        |
| xmlEncoding                               |                       | Неопределено  |
| xmlStandalone                             | Ложь                  | Булево        |
| xmlVersion                                |                       | Неопределено  |

https://infostart.ru/1c/articles/537440/

> Свойство `Документ.documentElement.innerHTML` возвращает или задает HTML код для `"Поля HTML документа"`

#### Запись и чтение HTML

Пример чтения из файла

```bsl
&НаКлиенте
Процедура ПрочитатьHTMLИзФайла(Команда)
    
    ЧтениеHTML = Новый ЧтениеHTML;
    ЧтениеHTML.ОткрытьФайл(″c:\temp\text_html.html″, ″UTF-8″);
    
    ПостроительDOM = Новый ПостроительDOM;
    ДокументHTML = ПостроительDOM.Прочитать(ЧтениеHTML);
    
    ЧтениеHTML.Закрыть();
    АдресHTML = ПолучитьТекстHTML(ДокументHTML); // Функция описана далее
    
КонецПроцедуры
```

В этом обработчике мы создаем объект `ЧтениеHTML` и открываем для чтения HTML-файл методом `ОткрытьФайл()` этого объекта. Затем создаем объект `ПостроительDOM` и вызываем его метод `Прочитать()`, в который передаем объект чтения `ЧтениеHTML`. В результате на основе прочитанных данных будет создан объект `ДокументHTML`

```bsl
&НаКлиенте
Функция ПолучитьТекстHTML(ДокументHTML)
    
    ЗапиcьHTML = Новый ЗаписьHTML;
    ЗапиcьHTML.УстановитьСтроку(); // установка режима записи в строку
    
    ЗаписьDOM = Новый ЗаписьDOM;
    ЗаписьDOM.Записать(ДокументHTML, ЗапиcьHTML);
    
    Возврат ЗапиcьHTML.Закрыть();
    
КонецФункции
```

После загрузки этого текста в реквизит `АдресHTML` содержимое документа будет показано в поле HTML-документа в форме обработки и у этого поля будет вызвано событие **`ДокументСформирован`**

**Запись HTML в файл**

```bsl
&НаКлиенте
Процедура СформироватьИЗаписатьHTML(Команда)
    СтрокаHTML =
    ″<html><head><meta content=’text/html;
    | charset=windows-1251’>
    | <title>Пример страницы</title></head>
    | <body><h1>Заголовок</h1>
    | <b>Полужирный;<i> полужирный и наклонный;</i>
    | </b><i> наклонный текст</i>
    | <p>новый абзац</p>
    | <table>
    |    <tr>
    |        <td>Первое</td>
    |        <td>Второе</td></tr>
    |    <tr>
    |        <td>Третье</td>
    |        <td>Четвертое</td></tr>
    | </table>
    | <p><img src=’C:/TEMP/pict_1.png’ alt=’Jardin’></img></p>
    | <p><a href=’http://www.v8.1c.ru’>1C</a></p>
    | </body></html>″;
    
    ДокументHTML = ПолучитьДокументHTML(СтрокаHTML);
    ЗапиcьHTML = Новый ЗаписьHTML;
    ЗапиcьHTML.ОткрытьФайл(″c:\temp\text_html.html″, ″UTF-8″);
    
    ЗаписьDOM = Новый ЗаписьDOM;
    ЗаписьDOM.Записать(ДокументHTML, ЗапиcьHTML);
    ЗапиcьHTML.Закрыть()
    
КонецПроцедуры
```

#### Обход DOM-дерева в цикле

Существует специальный метод, позволяющий легко обходить DOM-дерево HTML — `ДокументHTML.СоздатьОбходДерева()`

```bsl
&НаКлиенте
Процедура ПоказатьСтруктуруHTML(Команда)

    ДокументHTML = ПолучитьДокументHTML(Текст_HTML);
    Сообщение = Новый СообщениеПользователю();
    ТекстСообщения = ″″;
    
    // Стартовый узел: ДокументHTML.ЭлементДокумента
    ИтераторДерева = ДокументHTML.СоздатьОбходДерева(ДокументHTML.ЭлементДокумента);
    
    Пока ИтераторДерева.СледующийУзел() <> Неопределено Цикл
        Узел = ИтераторДерева.ТекущийУзел;
        ТекстСообщения = ТекстСообщения + ″Имя узла: ″ + Узел.ИмяУзла + Символы.ПС;
        Если НЕ ПустаяСтрока(Узел.ЗначениеУзла) Тогда
            ТекстСообщения = ТекстСообщения + ″Значение узла: ″ + Узел.ЗначениеУзла + Символы.ПС;
        КонецЕсли;
    КонецЦикла;
    
    Сообщение.Текст = ТекстСообщения;
    Сообщение.Сообщить();
    
КонецПроцедуры
```

#### Редактирование HTML

```bsl
&НаКлиенте
Процедура ИзменитьСодержимоеHTML(Команда)
    ДокументHTML = ПолучитьДокументHTML(Текст_HTML);
    Узлы = ДокументHTML.ПолучитьЭлементыПоИмени(″table″);
    Таблица = Узлы[0];
    
    НоваяСтрока = ДокументHTML.СоздатьЭлемент(″tr″);
    
    Таблица.ДобавитьДочерний(НоваяСтрока);
    
    НоваяЯчейка = ДокументHTML.СоздатьЭлемент(″td″);
    НоваяЯчейка.ТекстовоеСодержимое = ″Пятое″;
    НоваяСтрока.ДобавитьДочерний(НоваяЯчейка);
    
    НоваяЯчейка = ДокументHTML.СоздатьЭлемент(″td″);
    НоваяЯчейка.ТекстовоеСодержимое = ″Шестое″;
    НоваяСтрока.ДобавитьДочерний(НоваяЯчейка);
    
    АдресHTML = ПолучитьТекстHTML(ДокументHTML);
    
КонецПроцедуры
```

**Вставка фрагмента HTML**

```bsl
&НаКлиенте
Процедура ВставитьФрагментHTML(Команда)
    
    ДокументHTML = ПолучитьДокументHTML(Текст_HTML);
    
    Узлы = ДокументHTML.ПолучитьЭлементыПоИмени(″table″);
    Таблица = Узлы[0];
    
    Фрагмент =
    ″<p><b>Добавленный фрагмент</b></p>
    |<p><img src=’C:/TEMP/pict.jpg’ alt=’Fleur’></img></p>
    |<p><a href=’http://www.its.1c.ru’>ИТC</a></p>″;
    
    ФрагментHTML = ПолучитьДокументHTML(Фрагмент);
    ИзмененныйДокументHTML = ДокументHTML.ИмпортироватьУзел(ФрагментHTML.ЭлементДокумента, Истина);
    ДокументHTML.ДобавитьДочерний(ИзмененныйДокументHTML);
    ДокументHTML.ВставитьПеред(ИзмененныйДокументHTML, Таблица);
    АдресHTML = ПолучитьТекстHTML(ДокументHTML);
    
КонецПроцедуры
```

> `ДокументHTML.ЭлементДокумента` — это корневой элемент HTML документа

#1С #1С/Конфигурация/Макеты #HTML