> Все регистры являются [[02 Структура конфигурации 1С#Объектные и необъектные типы|необъектными типами]]

Существуют следующие виды регистров:

- Регистры накопления
- Регистры сведений
- Регистры бухгалтерии
- Регистры расчета

# Регистры накопления

> **Регистры накопления** предназначены для хранения и учета количественных изменений ресурсов (например, товаров, денег, материалов) в разрезе нескольких измерений (например, номенклатура, склад, подразделение)

Для регистра накопления платформа создает в базе данных таблицы, в которых будут накапливаться данные, поставляемые различными объектами ИБ.

Эти данные будут храниться в таблицах в виде отдельных записей, каждая из которых имеет одинаковую, заданную при конфигурировании регистра структуру

> Регистры накопления должны формироваться автоматически, а администраторы и программисты только анализировать их. Обычные пользователи не должны иметь доступа к ним

> **Ресурс** регистра накопления — это числовое значение, которое накапливается в регистре

> **Движение регистра накопления** — это запись со сведениями о совершенном событии, означающим изменение количественных характеристик объектов учета

Одна запись (экземпляр) регистра — это и есть движение. Движения можно наполнять дополнительной информацией, для этого можно создавать реквизиты в регистре

Структура движения регистра:

- Измерения
- Значения приращения ресурсов
- Регистратор (Ссылка на документ или другой объект, вызвавший изменения)
- Направление приращения (приход или расход)

**Регистратор** — источник события, который содержит информацию, необходимую для создания движений. Для регистра может быть определено множество регистраторов

> У регистра накопления всегда должен быть регистратор

**Когда происходит движение в регистр?**

— Чаще всего, при проведении документа

**Может ли посторонний объект, не являющийся регистратором совершать движения в регистр?**

## Структура объекта конфигурации


| Структурный элемент | Описание                                                                                                                |
| ------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| Измерения           | Измерения — это составной ключ, состоящий из свойств разных типов и идентифицирующий запись регистра среди всех записей |
| Ресурсы             | Для регистра накопления — числовые значения... Для регистра сведений — переменная любого типа...                        |
| Реквизиты           |                                                                                                                         |
| Формы               | Формы набора записей регистра, формы списка и произвольные формы, подчиненные регистру                                  |
| Команды             | Подчиненные регистру, команды                                                                                           |
| Макеты              | Макеты регистра                                                                                                         |

| Стандартные реквизиты | Описание                                                                  |
| --------------------- | ------------------------------------------------------------------------- |
| Период                | **`Дата`** и время записи регистра                                        |
| Регистратор           | **`ДокументСсылка.ИмяДокумента`** Источник движений                       |
| НомерСтроки           | Вместе с `Регистратором` идентифицирует запись регистра                   |
| Активность            | **`Булево`** Определяет будет ли учитываться запись регистра в его итогах |
| ВидДвижения           | **`ВидДвиженияНакопления { Приход, Расход }`**                            |

> Идентификатором регистра накопления является совокупность ссылки на регистратор и номер строки

## Разновидности регистров накопления

Регистры накопления могут быть двух видов:

- Регистры остатков
- Регистры оборотов

Для регистров остатков система всегда создает три виртуальные таблицы:

- Таблица остатков "`Остатки`"
- Таблицу оборотов "`Обороты`"
- Совокупная таблица остатков и оборотов "`ОстаткиИОбороты`"

Для регистров оборотов система создает только одну виртуальную таблицу:

- Таблица оборотов

Оборотный регистр накопления очень похож на регистр остатков, но для него понятие «остаток» не имеет смысла. Оборотный регистр накапливает только обороты. В остальном оборотный регистр ничем не отличается от регистра остатков.

по каждому из измерений регистра накопления остатков ресурсы обязательно должны изменяться в обе стороны: приход и расход. Не должно существовать таких измерений, по которым осуществляется только приход или только расход.

Нарушение этого принципа построения регистров накопления будет вести к непроизводительному использованию ресурсов системы и как следствие – к замедлению работы и падению производительности

Для реквизитов же регистра этот принцип не важен. По реквизитам регистра ресурсы могут только приходоваться или только расходоваться.

Для регистров оборотов отсутствует параметр `ВидДвижения`, так как он не должен использоваться

### Виртуальная таблица Остатки

Виртуальная таблица остатков для расчета данных всегда использует таблицу итогов и иногда таблицу движений. Использование таблицы движений зависит от момента времени, на который считаются остатки, и периода рассчитанных итогов. При расчете остатков используются довольно простая стратегия.

1. Подбирается ближайший больший или равный момент времени, на который рассчитаны остатки.
2. На этот момент получаются остатки из таблицы итогов.
3. Если момент времени, на который считаются остатки, не совпадает с моментом времени итогов, то остатки досчитываются по движениям за период с момента запроса остатков по момент итогов.

Рассмотрим несколько примеров. Пусть период рассчитанных итогов равен 31.07.2004. Мы хотим получить остатки на 01.07.2004, 15.07.2004, 01.08.2004, 15.08.2004 и актуальные остатки.
Для случаев получения остатков на 01.07.2004, 01.08.2004 и актуальных остатков данные будут получены непосредственно из таблицы итогов. В случае получения остатков на 15.07.2004 сначала будут получены данные из таблицы итогов на момент времени 01.08.2004, так как это ближайший больший момент времени, на который посчитаны остатки, а затем будут обработаны данные из таблицы движений за период с 15.07.2004 по 31.07.2004 включительно. В случае получения остатков на 15.08.2004, ближайшим большим моментом времени, на который посчитаны остатки является момент актуальных остатков. Таким образом, для расчета остатков на 15.08.2004, будут получены актуальные итоги и обработаны данные таблицы движений начиная с 15.08.2004.

### Виртуальная таблица Обороты

Виртуальная таблица оборотов всегда работает по данным таблицы движений. То есть для получения оборотов за какой-либо период будут обработаны данные таблицы движений за этот период, независимо от периода рассчитанных итогов.

### Виртуальная таблица ОстаткиИОбороты

### Виртуальная таблица ОстаткиИОбороты

Виртуальная таблица остатков и оборотов рассчитывает одновременно и остатки, и обороты. В зависимости от того, указана периодичность или нет, изменяется способ работы данной таблицы. Если периодичность не указана, то расчет данных производится единым запросом, который в свою очередь содержит подзапросы. Один из них вычисляет остатки на начальный момент периода, как это описано для виртуальной таблицы остатков, второй -обороты за заданный период, как это описано для виртуальной таблицы оборотов. Результаты подзапросов объединяются и выдаются как единый результат.

В случае если периодичность задана, расчет данных разбивается на следующие шаги:
1. Получение остатков на начало заданного периода.
2. Получение оборотов с заданной периодичностью за заданный период.
3. Объединение данных двух запросов.

### Отличие оборотного регистра от регистра остатков

В отличие от регистра остатков, оборотный регистр накапливает обороты. По данному регистру нельзя посчитать остатки, и поэтому для него существуют только одна виртуальная таблица оборотов. Структура таблицы движений оборотного регистра не сильно отличается от таблицы движений регистра остатков. Она имеет следующую структуру:

1. Период
2. Регистратор
3. Номер строки
4. <Измерения>
5. <Ресурсы>
6. <Реквизиты>

Очевидно, что в таблице движений оборотного регистра отсутствует только поле `ВидДвижения`. Таблица же итогов оборотного регистра по своей структуре идентична структуре таблицы регистра остатков:

1. Период
2. <Измерения>
3. <Ресурсы>

Но сходство этих таблиц на этом и заканчивается. В таблице итогов оборотного регистра хранятся обороты с периодичностью месяц. Итоги хранятся за все периоды, за которые были движения и не ограничиваются периодом рассчитанных итогов. В таблице итогов оборотного регистра не хранятся актуальные данные, так как для оборотов такого понятия не существует.

----
## [Внутреннее устройство регистров](https://www.koderline.ru/expert/instruktsii/article-ispolzovanie-virtualnykh-tablits-1s-v-zaprosakh/)

Регистры состоят из двух таблиц, которые хранятся в базе данных, это **таблица движений** и **таблица итогов**.
Расчет таблицы итогов будет зависеть от вида регистра 1С, структура имеет следующий вид:

Посредством запроса 1С можно обратиться к движениям и к виртуальным таблицам 1С, доступ к итогам напрямую невозможен.

**Использование таблицы движений является крайне нежелательной, т.к. она содержит максимальное количество записей, обработка которых будет сильно нагружать систему.**

#1С #1С/Конфигурация/Регистры