
Любая конфигурация 1С имеет следующую структуру:

![[1С Структура конфигурации.png]]

Все перечисленные объекты называются **объектами метаданных** или **объектами конфигурации**.

У каждого объекта метаданных есть своства, которые можно открыть в специальном окне (нажав правую кнопку мыши).

У всех объектов есть:

* [[07 Реквизиты и константы#^eb082d|Ссылка]] — уникальный идентификатор объекта (GUID) в системе (не является адресом в памяти). Ссылки имеют такой формат: `9cd510cd-abfc-11d4-9434-004095e12fc7` (`XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX`). Для ссылок определено представление, отображаемое пользователю.
* **Имя** — название объекта метаданных. Имя должно быть уникальным в рамках одной ветви дерева метаданных. Имя должно начинаться с буквы или `_` и содержать только буквы, цифры или `_`.
* **Синоним** — неуникальное имя, отображаемое пользователю. Ограничений для синонима нет, то есть можно задать синоним такого плана: `:№?№╰(*°▽°*)╯©※‱⁇±௹¤₧`
* **Комментарий** — пометка для разработчиков, которая может использоваться, например, в глобальном поиске

Также часто встречающиеся свойсвта объектов:

* **Представление объекта** — отображаемое название объекта в UI в контексте единственного числа
* **Расширенное представление объекта** — 
* **Представление списка** — отображение названия объекта в контексте набора объектов
* **Расширенное представление списка** — 

[[12 Модули|Модули]] с кодом определены на разных иерархических уровнях: на уровне приложения, сеанса, конфигурации, типа объекта, экземпляра объекта, формы...

#### Список вкладок конфигурации

| Вкладка или объект                             | Описание                                                                                                                                                                           |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Общие                                          | раздел с объектами, определенных на уровне приложения                                                                                                                              |
| Константы                                      | **Изменяемые** переменные, определяемые на уровне всей конфигурации. Для констант можно определять форму и задавать код в модуле константы. Форма констант может быть только общей |
| [[04 Справочники и перечисления\|Справочники]] | предназначены для хранения списочных и иерархических данных (Сотрудники, Товары, Изделия...). Является самым близким аналогом классической реляционной таблицы SQL                 |
| [[01 Документы\|Документы]]                    | объекты, предназначенные для регистрации событий и операций                                                                                                                        |
| [[02 Журналы документов\|Журналы документов]]  | объекты, предназначенные для объединения разных документов в единый список                                                                                                         |
| Перечисления                                   | объекты, предназначенные для хранения фиксированных наборов значений                                                                                                               |
| [[01 Отчеты и СКД\|Отчеты]]                    | Предназначены для сбора информации из разных объектов и ее представления в удобном виде. Внешние отчеты являются независимыми подключаемыми файлами                                |
| [[10 Обработки\|Обработки]]                    | Предназначены для выполнения специальных обработок данных. Внешние обработки являются независимыми подключаемыми файлами                                                           |
| Планы видов характеристик                      | объекты, предназначенные для хранения характеристик объектов учета                                                                                                                 |
| Планы счетов                                   | объекты, предназначенные для хранения информации о счетах бухгалтерского учета                                                                                                     |
| Планы видов расчетов                           | объекты, предназначенные для хранения видов расчетов, используемых в системе                                                                                                       |
| Регистры сведений                              | Не предназначен для простых ~~смертных~~ пользователей. Используется для хранения внутренних данных для формирования конечных данных, доступных пользователю                       |
| Регистры накопления                            | Содержат информацию о движениях документов (приход и расход)                                                                                                                       |
| Регистры бухгалтерии                           | объекты, предназначенные для ведения бухгалтерского учета                                                                                                                          |
| Регистры расчета                               | объекты, предназначенные для ведения расчетов и начислений                                                                                                                         |
| Бизнес-процессы                                | объекты, предназначенные для описания и автоматизации бизнес-процессов                                                                                                             |
| [[16 Задачи и бизнес-процессы\|Задачи]]        | объекты, предназначенные для управления задачами и их выполнением                                                                                                                  |
| Внешние источники данных                       | объекты, предназначенные для интеграции с внешними системами и источниками данных                                                                                                  |

**Вкладка "Общие"**

| Общий объект                   | Описание                                                                                                                                                                |
| ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Подсистемы                     | объекты, предназначенные для группировки и структурирования функциональности конфигурации                                                                               |
| Общие модули                   | глобальные модули, содержащие процедуры и функции, доступные из любого места конфигурации                                                                               |
| Параметры сеанса               | объекты, предназначенные для хранения параметров текущего сеанса пользователя                                                                                           |
| Роли                           | объекты, предназначенные для определения прав доступа пользователей к объектам конфигурации                                                                             |
| Общие реквизиты                | реквизиты, общие для нескольких объектов конфигурации. Скрыто для каждого объекта конфигурации, имеющего этот реквизит, создается своя локальная копия общего реквизита |
| Планы обмена                   | объекты, предназначенные для настройки обмена данными между различными информационными базами                                                                           |
| Критерии отбора                | объекты, предназначенные для определения условий отбора данных                                                                                                          |
| Подписки на события            | объекты, предназначенные для обработки событий, происходящих в системе                                                                                                  |
| Регламентные задания           | объекты, предназначенные для автоматического выполнения задач по расписанию                                                                                             |
| Боты                           | объекты, предназначенные для автоматизации взаимодействия с пользователями через мессенджеры                                                                            |
| Функциональные опции           | объекты, предназначенные для управления функциональностью конфигурации в зависимости от условий                                                                         |
| Параметры функциональных опций |                                                                                                                                                                         |
| Определяемые типы              | пользовательские типы данных, фактически, являющиеся обычными типами с предопределенными параметрами (для числа это точность, длина и знак; для строки - это длина...)  |
| Хранилища настроек             | объекты, предназначенные для хранения настроек пользователей и системы                                                                                                  |
| Общие команды                  | команды, доступные из любого места конфигурации                                                                                                                         |
| Группы команд                  | объекты, предназначенные для группировки команд                                                                                                                         |
| Общие формы                    | формы, доступные из любого места конфигурации                                                                                                                           |
| Общие макеты                   | макеты, доступные из любого места конфигурации                                                                                                                          |
| Общие картинки                 | Файлы изображений, доступные из любого места конфигурации                                                                                                               |
| XDTO-пакеты                    | объекты, предназначенные для работы с XML-документами и для конвертации данных при сетевом взаимодействии                                                               |
| HTTP-сервисы                   | Объекты, представляющие простые API по HTTP протоколу без контроля целостности данных                                                                                   |
| Web-сервисы                    | Расширенное сетевое API, поддерживает SOAP запросы и проверку целостности данных                                                                                        |
| WS-ссылки                      | объекты, предназначенные для работы с веб-сервисами через ссылки                                                                                                        |
| Сервисы интеграции             | объекты, предназначенные для интеграции с внешними системами                                                                                                            |
| Элементы стиля                 | Предопределенные параметры элементов форм                                                                                                                               |
| Стили                          | Темы, совокупности элементов стиля                                                                                                                                      |
| Языки                          | объекты, предназначенные для поддержки многоязычности в конфигурации                                                                                                    |

### Реквизиты

Реквизит — свойство объекта конфигурации, имеющее определенный тип данных. Реквизит также является объектом конфигурации

Типы данных реквизитов

| Тип данных                                     | Описание                                                    |
| ---------------------------------------------- | ----------------------------------------------------------- |
| Число                                          | Число с заданной точностью и длиной                         |
| Строка                                         | до 1024 двухбайтовых символов                               |
| Дата                                           |                                                             |
| Булево                                         | `Ложь` и `Истина`                                           |
| Хранилище значений                             | Универсальный тип данных, хранящий значения в бинарном виде |
| Уникальный идентификатор                       | GUID объекта конфигурации                                   |
| ([[07 Реквизиты и константы#^eb082d\|Ссылка]]) | GUID, ссылка на объект метаданных                           |

## Обновление информационной базы

При наличии изменений, будь то добавленный комментарий или реквизит метаданные конфигурации будут изменены. Если метаданные были изменены, необходимо обновить конфигурацию, прежде чем запустить. Однако, нельзя обновлять оригинальную информационную базу, пока к ней подключены пользователи, потому что, если обновить базу, то у пользователей изменений не будет, их конфигурация будет прошлой версии. Это приводит к несовметсимости и исключениям. Чтобы избежать этих проблем, нужно отключить всех пользователей от приложения, затем обновить его и потом уже подключить пользователей.

Можно делать откат к последней сохраненной версии конфигурации:

```
(Главное меню):Конфигурация > Конфигурация базы данных > Вернуться к конфигурации БД
```

## Общая структура объектов конфигурации

Основные объекты конфигурации, такие как Регистры, Справочники, Документы имеют общее ядро из одинаковых свойств и методов.

Общая структура:

Методы:

- **`Записать()`**: Выполняет сохранение данных об объекте в информационную базу. Если объект хранится в базе данных, то он хотя бы 1 раз был записан

Свойства:

- **`Ссылка`**: (Используется в: Документы, Справочники, Регистры) Ссылка на текущий объект в информационной базе
- **`ПометкаУдаления`**: (Используется в: Документы, Справочники) Флаг, который говорит о том, что объект готов к удалению. Пометки на удаление нужны, чтобы корректно выполнять групповое удаление взаимосвязанных объектов. Если непосредственно выполнять удаление, то может нарушиться целостность данных.

События:

- **`ПередЗаписью`**: Выполняется перед совершением записи объекта в базу данных. В обработчике события можно отменять запись при заданных условиях
- **`ПриЗаписи`**: Выполняется после записи
- **`ОбработкаЗаполнения`**:
- **`ОбработкаПроверкиЗаполнения`**:

## Объектные и необъектные типы

Объектные типы — это объекты БД ссылочных типов, которые идентифицируются ссылкой (GUID), а не набором хранимых данных. Если удалить такой объект и заново создать, заполнив точно такими же данными, то для системы это будет совершенно новый объект.

Объектные типы имеют поле **`Ссылка`**, которое содержит уникальный идентификатор (GUID)

Необъектные типы — это объекты БД, которые идентифицируются совокупностью хранимых значений. Платформа не различает 2 необъектных значения, если они содержат одинаковые данные, никаких специальных идентификаторов система не создает.

| Объектные типы            | Необъектные типы     |
| ------------------------- | -------------------- |
| Справочники               | Регистры накопления  |
| Документы                 | Регистры сведений    |
| Журналы документов        | Регистры бухгалтерии |
| Перечисление              | Регистры расчета     |
| Планы видов характеристик |                      |
| Планы видов расчетов      |                      |
| Планы счетов              |                      |
| Задачи                    |                      |
| Бизнес-процессы           |                      |

Допустим у нас есть `Документ.ОказаниеУслуги` с реквизитом `Номенклатура` с типом `СправочникСсылка.Номенклатура`. Если нам нужно из документа получить какой-то реквизит `Номенклатуры`, то система сначала обратиться по ссылке справочника в кэш и если там нет нужной информации, сформируется запрос к базе данных для получения нужного реквизита.
При этом будут прочитаны все данные объекта `Номенклатура`

Как несложно догадаться, подобное обращение к базе данных требует большего количества времени, нежели просто чтение из оперативной памяти. При интерактивном заполнении документа подобные задержки ничтожно малы по сравнению со скоростью работы пользователя. Однако при выполнении большого количества расчетов (например, при проведении больших документов, содержащих несколько тысяч строк) разница во времени будет значительной

## Экспорт и импорт конфигурации

Можно выгрузить всю информационную базу в файл `.dt`. Для этого во вкладке "Администрирование" нужно нажать "Выгрузить информационную базу...".

Аналогично можно выгрузить и загрузить конфигурацию из файла (вкладка Конфигурация)

### Файл `.dt` (Data Transfer)

Бинарный файл `.dt` хранит в себе данные и конфигурацию (метаданные)

>Выгрузка и загрузка информационной базы невозможна, пока хотя бы 1 пользователь использует приложение 1С.

### Файл `.cf` (`.cfu`) (Configuration File)

Это бинарный файл, который хранит метаданные (структура конфигурации) и исходный код модулей

Конфигурацию можно выгрузить "в файлы", то есть сохранить конфигурацию как древо каталогов с файлами xml, html, bin, bsl и другими. К примеру, какой-нибудь справочник будет выгружен в файл XML, а модуль этого справочника в файл `.bsl`

>Благодаря использованию XML можно выполнять обработку и анализ конфигурации как программными средствами, так и вручную.

При выгрузке в XML файлы, создается специальный служебный файл **ConfigDumpInfo.xml**, который называется **файлом версий**. Он хранится в каталоге выгрузки вместе с остальными файлами XML, и содержит информацию о формате выгрузки, о версии выгрузки, и о версиях всех объектов, которые были выгружены.

> Настройки конфигурации, такие как шрифты и шаблоны текста независимы от конкретной конфигурации. Эти настройки определяются для всей платформы локально на ПК

#### [Инкрементальная выгрузка и загрузка](https://wonderland.v8.1c.ru/blog/inkrementalnaya-vygruzka-konfiguratsii-v-xml/)

Поддерживается **инкрементальная** выгрузка. Она сокращает время выгрузки за счёт того, что выгружаются только те файлы, которые были изменены с момента предыдущей выгрузки. Аналогичным образом выполняется и инкрементальная загрузка.

Если выгрузка выполняется в первый раз (или если в каталоге выгрузки отсутствует файл версий), то выполняется полная выгрузка, генерируется файл версий.

Если в каталоге выгрузки уже есть файл версий, то выгружаются только изменения конфигурации по отношению к файлу версий, файл версий обновляется.

Благодаря выгрузке Конфигурации в XML, можно автоматизировать процессы обработки конфигураии. Например, можно сделать аудит, который будет проверять правильность прав доступа, стандартов написания кода и т.д. 

Можно написать простой скрипт, который будет делать выгрузку в XML после завершения рабочего дня:

```CMD
1cv8.exe config /DumpConfigToFiles C:\xml –update
```

* `-update` говорти о том, что нужно обновить только файлы конфигурации, которые были изменены, добавлены или удалены

Этот скрипт позволяет записать информацию об изменениях в конфигурации. Если изменений нет, то файл будет пустым.

```CMD
1cv8.exe config /DumpConfigToFiles C:\xml -getChanges C:\diff.txt
```

Выгрузка в файлы XML и использование оптимизированных обновлений может использоваться для группового доступа к конфигурации. Можно использовать внешнюю систему контроля версий, которая будет связана с каталогом, где храниться конфигурация (множество файлов)

Также можно сохранить обновлненные файлы конфигурации в отдельном каталоге. Например можно сделать патч, исправляющий какие-то баги, который будет сохраняться отдельно

```
1cv8.exe config /DumpConfigToFiles C:\xml_patch -update –configDumpInfoForChanges C:\xml_source\ConfigDumpInfo.xml
```

**`C:\xml_source\ConfigDumpInfo.xml`** — это файл версий эталонной конфигурации
**`C:\xml_patch`** – каталог, в который будут выгружены только те XML файлы, которые исправляют обнаруженные ошибки.

**`ConfigDumpInfoForChanges`** — это ключ, который позволяет указать конкретный файл версий, от которого нужно «отсчитывать» изменения.

#1С #1С/Конфигурация