На формах доступны несколько типов коллекций. Каждый тип коллекции на форме представляется своим типом: `СпискокЗначений` или `ДанныеФормыКоллекция`. Поэтому, все коллекции должны соответствовать интерфейсам взаимодействия форм с одним унифицированным набором методов.

* `СписокЗначений` $\rightarrow$ **`СписокЗначений`**
* `ТабличнаяЧасть, ТаблицаЗначений, ДинамическийСписок` $\rightarrow$ **`ДанныеФормыКоллекция`**
* `ДеревоЗначений` $\rightarrow$ **`ДанныеФормыДерево`**

ТаблицуЗначений и СписокЗначений можно отображать на форме как одно поле, где перечислены все элементы. Для других коллекций эта возможность отсутствует.

# ДанныеФормыКоллекция

Этот тип представляет собой упорядоченную коллекцию, предназначенную для отображения на форме. Источником данных для этого объекта могут быть:

- ДинамическийСписок
- ТабличнаяЧасть
- ТаблицаЗначений

ПАРУ СКРИНОВ

### Свойства

Элемент коллекции: `ДанныеФормыЭлементКоллекции`

**Свойства элемента коллекции:**

- `ИсходныйНомерСтроки` — номер строки. Если источником данных является ТабличнаяЧасть, то номера строк беруться из нее

**Методы элемента:**

- `[Число] ПолучитьИдентификатор()` — ID элемента без привязки к позиции
- `[Булево] Свойство(ключ, найденноеЗначение)` — поиск свойства с заданным именем

### Методы

| Метод                                          | Описание                                                                                                                                                                                                                                    |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Добавить()`                                   | Добавление строку в конец и возвращает ее                                                                                                                                                                                                   |
| `Вставить(индекс)`                             | Добавление строки в указанную позицию                                                                                                                                                                                                       |
| `Загрузить(таблицаЗначений)`                   | заполняет всю коллекцию целиком на основе ТЗ. Если в коллекции формы нет свойств с именами, которые есть в ТЗ, то эти свойства не будут учитываться                                                                                         |
| `Выгрузить(строкиИлиПараметрыОтбора, колонки)` | возвращает ТЗ, в которую выгружаются данные из указанных строк и столбцов (или из всех строк и столбцов). Вместо указания строк можно задать параметры отбора                                                                               |
| `Получить()`                                   | Аналог оператора `[]`                                                                                                                                                                                                                       |
| `Сдвинуть(строка, смещение)`                   | Сдвиг строки на указанное число позиций вниз (`+смещение`) или вверх (`-смещение`). Можно передавать индекс строки или ссылку на нее.                                                                                                       |
| `Итог(имяКолонки)`                             | Попытка суммирования всех числовых значений в столбце. Если в столбце несколько типов, то они будут преобразовываться к Числу, если среди полей в колонке есть числа, то преобразований не будет, если чисел нет, итог будет `неопределено` |
| `Индекс(строка)`                               | Индекс текущей строки или `-1`, если строка не найдена                                                                                                                                                                                      |
| `НайтиПоИдентификатору(ID)`                    | поиск элемента коллекции по числовому идентификатору, если не найдено, возвращает `неопределено`                                                                                                                                            |
| `НайтиСтроки(параметрыПоиска)`                 | поиск массива строк, удовлетворяющим параметрам поиска. ПараметрыПоиска — это Структура, где ключом является имя колонки, а значением — искомое значение                                                                                    |
| `Сортировать(именаКолонок, [объектСравнения])` | Сортировка по указанным, через запятую, колонкам. После каждого имени колонки можно указать порядок сортировки: Возр или Убыв (Asc или Desc). объектСравнения — это инфа о способе сравнения при сортировке                                 |
| `Удалить(строка)`                              | Удаление строки по индексу или по ссылке на строку                                                                                                                                                                                          |
| `Очистить()`                                   | Очищение коллекции                                                                                                                                                                                                                          |

Можно выделить 2 способа заполнения таблицы на форме:

1. Через создание ТЗ и загрузку ее в `ДанныеФормыКоллекция` (`таблица.Загрузить(ТЗ)`). Данный способ немного более удобный, но требует создания ТаблицыЗначений, которая целиком хранится в ОЗУ, что может негативно сказаться на производительности.
2. Без создания ТЗ. Можно напрямую, получая данные из выборки, полученной из запроса к БД, в цикле получать каждую отдельную строку:

```bsl
Выборка = РезультатЗапроса.Выбрать();
Пока Выборка.Следующий() Цикл
    ЗаполнитьЗначенияСвойств(ТаблицаНаФорме.Добавить(), Выборка);
КонецЦикла;
```

Второй способ лучше подходит для обработки большого количества записей таблиц

# ДанныеФормыДерево

Является представлением типа ДеревоЗначений на форме

### Методы

- **`НайтиПоИдентификатору(кодЭлементаДерева)`** — возвращает элемент дерева или неопределено, если элемент по указанному ID не найден
- **`ПолучитьЭлементы()`** — возвращает коллекцию типа `ДанныеФормыКоллекцияЭлементовДерева`, которая содержит все элементы верхнего уровня дерева

# Список значений

**Доступность:** Везде

Может быть отображен двумя способами:

* Таблица
* Поле

В настройках списка значений (на форме) можно ограничить типы элементов списка, доступные для выбора. Для этого во вкладке "Объект" нужно установать значение свойства "Тип значения". Программно тоже можно ограничивать допустимые типы.

### Отображение в виде таблицы

Доступен следующий функционал:

* Добавить (Кнопка) — добавление нового элемента с определенным типом
* Подбор (Кнопка) — открытие формы выбора с возможностью выбора нескольких элементов, которые будут добавлены в список значений
* Удалить (Доп. кнопка) — удаление текущего элемента
* Изменить (Доп. кнопка) — редактирование элемента
* Скопировать (В подменю "Еще") — Дублирование выбранного элемента
* (Инструменты поиска)
* Переместить вверх/вниз — перемещение строки вверх или вниз
* Сортировать по ... — сортировка по убыванию или по возрастанию

### Отображение в виде поля

Список значений в виде поля отображается как поле ввода с надписью слева по умолчанию. Функционал такого списка полностью аналогичен вышеописанному. Элементы перечисляются через символ `;`

# Динамический список

**Доступность:** `&НаКлиенте`, `&НаСервере`, `На форме`

Представляет собой таблицу, получаемую из произвольного запроса к БД. Запрос может быть сформирован вручную или автоматически при указании **основной таблицы**. Все строки таблицы имеют одинаковые столбцы

Динамический список имеет множество различных параметров, которые можно настравивать:

- **Параметры запроса** — выражения, подставляемые в код запроса
- **Отбор** — установка фильтра, отбирающего только нужные строки
- **Сортировка** — одноуровневая или многоуровневая сортировка строк в таблице
- **Условное оформление** — визуальное оформление, которое зависит от заданных условий
- **Группировка** — одноуровневая или многоуровневая группировка строк в таблице по той или иной колонке или переменной

### Свойства динамического списка

| Свойство                                                | Описание                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`АвтоЗаполнениеДоступныхПолей`**                      | Тип: `Булево`; Если Истина – доступные поля заполняются по правилам автоматического заполнения доступных полей набора данных схемы компоновки данных. Если Ложь – в качестве доступных полей компоновки данных используются поля, явно добавленные с помощью расширения языка запросов для системы компоновки данных. Если свойство ПроизвольныйЗапрос имеет значение Ложь, значение данного свойства не учитывается. |
| **`АвтоматическоеСохранение-ПользовательскихНастроек`** | Тип: `Булево`; Определяет будут ли автоматически сохраняться пользовательские настройки (такие как Сортировка, Группировка, Отбор и т.д.)                                                                                                                                                                                                                                                                             |
| **`ВидКлюча`**                                          | Тип: `ВидКлючаДинамическогоСписка`; Доступные значения: `Авто`, `ЗначениеПоля`, `КлючСтроки`, `НомерСтроки`; Если основная таблица указана, допускается использовать только значение `Авто`.                                                                                                                                                                                                                          |
| **`ВычисляемыеПоля`**                                   | Тип: `ВычисляемыеПоляСхемыКомпоновкиДанных`; Информация о вычисляемых полях в ДС                                                                                                                                                                                                                                                                                                                                      |
| **`Группировка`**                                       | Тип: `ПоляГруппировкиКомпоновкиДанных`; **Столбцы**, по которым в ДС будет осуществляться группировка (ХЗ, почему назвали это полями)                                                                                                                                                                                                                                                                                 |
| **`ДинамическоеСчитываниеДанных`**                      | Тип: `Булево`; Определяет, будут ли данные запроса загружаться динамически по мере необходимости их отображения на форме                                                                                                                                                                                                                                                                                              |
| **`КлючТекущихПользовательских-Настроек`**              | Тип: `Произвольный`; Возвращает ключ текущих настроек пользователя                                                                                                                                                                                                                                                                                                                                                    |
| **`КомпоновщикНастроек`**                               | Возвращает ссылку на используемый объект компоновщика настроек `КомпоновщикНастроекКомпоновкиДанных`                                                                                                                                                                                                                                                                                                                  |
| **`ОсновнаяТаблица`**                                   | Тип: `Строка`; Строковый адрес типа, который выступает в роли главной таблицы данных, используемой в ДС. Например: `"Справочник.Номенклатура"`                                                                                                                                                                                                                                                                        |
| **`Отбор`**                                             | Информация об отборе. Тип: `ОтборКомпоновкиДанных`                                                                                                                                                                                                                                                                                                                                                                    |
| **`Параметры`**                                         | Список параметров, которые учавствуют в запросе                                                                                                                                                                                                                                                                                                                                                                       |
| **`ПараметрыДанных`**                                   | ???                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **`ПолучениеПредставлений-ДляНевидимыхПолей`**          | Тип: Булево; ???                                                                                                                                                                                                                                                                                                                                                                                                      |
| **`Поля`**                                              | Содержит описание всех столбцов таблицы ДС                                                                                                                                                                                                                                                                                                                                                                            |
| **`ПоляКлюча`**                                         | Тип: ФиксированныйМассив; Коллекция путей к ключевым столбцам таблицы. Используется только при отсутствии **Основной таблицы**                                                                                                                                                                                                                                                                                        |
| **`Порядок`**                                           | Описывает порядок сортировки                                                                                                                                                                                                                                                                                                                                                                                          |
| **`ПроизвольныйЗапрос`**                                | Тип: Булево; Определяет будет ли запрос формироваться произвольно или автоматически                                                                                                                                                                                                                                                                                                                                   |
| **`ТекстЗапроса`**                                      | Текст с кодом запроса к БД, который будет выполняться для получения данных                                                                                                                                                                                                                                                                                                                                            |
| **`УсловноеОформление`**                                | Информация об условном оформлении данных                                                                                                                                                                                                                                                                                                                                                                              |

### Методы

Ничего интересного, кроме возможности вручную устанавливать Ограничения использования в Группировке/Отборе/Порядке.

#1С #1С/Формы #1С/Язык_программирования/Коллекции