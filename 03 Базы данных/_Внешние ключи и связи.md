Базы данных могут содержать таблицы, которые связаны между собой различными связями.
При выделении связи выделяют главную или родительскую таблицу (primary key table / master table) и зависимую, дочернюю таблицу (foreign key table / child table). Дочерняя таблица зависит от родительской.

Для организации связей между таблицами используются _**внешние ключи**_.
>Внешний ключ представляет собой атрибут или несколько атрибутов, который является потенциальным ключом из другой таблицы. Обычно внешний ключ соответствует первичному ключу родительской таблицы.

## Связи между таблицами

* Один к одному (one to one)
* Один ко многим (one to many) (многие к одному)
* Многие ко многим (many to many)

### Связь один к одному

Например пользователь может составить свой блог на сайте. Существует 2 таблицы Users & Blogs.

![[MS_SQL_06.png]]
Атрибут BlogId — это первичный ключ для таблицы Blogs и, одновременно, внешний ключ, совпадающий с первичным ключом главной таблицы Users.

### Связь один ко многим

Это наиболее часто встречаемый тип связей. В этом типе связей несколько строк из дочерний таблицы зависят от одной строки в родительской таблице. Например, в одном блоге может быть несколько статей. В этом случае таблица блогов является родительской, а таблица статей - дочерней. То есть один блог - много статей.

К примеру, пусть будет таблица Articles, которая представляет статьи блога имеет следующие столбцы:
* ArticleId (первичный ключ)
* BlogId (внешний ключ)
* Title (название стати)
* Text (текст статьи)

![[2_bbb.png]]
Несколько статей ссылаются на один блог.

### Связь многие ко многим

При этом типе связей одна строка из таблицы А может быть связана с множеством строк из таблицы В. В свою очередь одна строка из таблицы В может быть связана с множеством строк из таблицы А. Типичный пример — студенты и курсы: один студент может посещать несколько курсов, и соответственно на один курс могут записаться несколько студентов. Еще один пример — заметки и теги. Заметки могут иметь много тегов, а тегам могут соответствовать много заметок.

Организация связи многие ко многим невозможна напрямую. Для этого необходимо использовать дополнительную табилицу.

Почему связь "многие ко многим" нельзя использовать напрямую? — Потому что каждая связь должна отображатся в атрибутах сущности в виде внешнего ключа, но количество связей между сущностями может быть разным и, соответственно, и количество атрибутов является непостоянным для каждого экземпляра. Можно было бы создать много атрибутов под возможные связи, но это очень не эффективно и первичные ключи не могут быть NULL. — Мои мысли.

Пример: Имеются статьи, которые могут иметь несколько тегов и, соответственно, теги, которые могут указывать на несколько статей.
Таблица Tags:
* TagId (первичный ключ)
* Text (текст тега)
Также пусть будет промежуточная таблица ArticleTags со следующими полями:
* TagId (первичный и внешний ключ)
* ArticleId (первичный и внешний ключ)
Таблица Articles описана ранее.

Несколько таблиц ArticleTags ссылаются на Articles и на Tags.
Фактически осуществлено две связи "один ко многим".
Одна статья — много тегов для этой статьи (ArticleTags);
Один тег — много соответствующих этому тегу статей (ArticleTags).

## Ссылочная целостность данных

При изменении первичных и внешних ключей нужно соблюдать **_ссылочную целостность данных (referential integrity)_**. Ее основная идея состоит в том, чтобы таблицы, которые хранят одни и те же данные, поддерживали их согласованность. Кроме того таблицы должны иметь правильно выстроенные отношения с корректной установкой ссылок между ними.

Целостность может нарушаться в следующих случаях:
* Аномалия удаления (deletion anomaly). Возникает при удалении строки из главной таблицы. В этом случае внешний ключ из зависимой таблицы продолжает ссылаться на удаленную строку из главной таблицы
* Аномалия вставки (insertion anomaly). Возникает при вставке строки в зависимую таблицу. В этом случае внешний ключ из зависимой таблицы не соответствует первичному ключу ни одной из строк из главной таблицы.
* Аномалии обновления (update anomaly). При подобной аномалии несколько строк одной таблицы могут содержать данные, которые принадлежат одному и тому же объекту. При изменении данных в одной строке они могу прийти в противоречие с данными из другой строки.

[продолжение](https://metanit.com/sql/tutorial/1.3.php)

#DB