
> **PowerShell** — это язык сценариев, предназначенный для автоматизации задач управления и конфигурации систем, а также для работы с различными административными задачами в операционных системах Windows и других платформах.

Язык является интерпретируемым, с динамической **сильной** типизацией, платформонезависимый (Windows, Linux, Mac OS). Поддерживает функциональную и объектно-ориентированную парадигму. Совместим с платформой .NET

Язык PowerShell является надстройкой над Batch или Bash скриптами, позволяющий использовать дополнительные возможности

```powershell
Write-Output "Hello, World!"
```

**PowerShell совместим с Batch и Bash.** Язык разрабатывался с целью предоставить возможность мягкого перехода от batch и bash к PowerShell. PowerShell воспринимает команды Batch и Bash как псевдонимы своих команд (**командлет**) 

## Назначение PowerShell

PowerShell предназначен для автоматизации повторяющихся задач в рамках компьютера, локальной, корпоративной и глобальной сети. На фоне других языков программирования, PowerShell выделяется очень упрощенным выполнением комплексных действий одной-двумя командами.

## Обзор возможностей PowerShell

PowerShell — это полноценный кроссплатформенный язык программирования экосистемы .NET. PowerShell является мощным интерфейсом взаимодействия с ОС. К примеру, такие действия, как отправка HTTP запроса, регистрация новой службы в реестре Windows, пересылка сообщения на компьютер в виде всплывающего окна, выполняются в PowerShell одной командой

Что можно делать на PowerShell:

- Программировать в классическом понимании
- Создавать скрипты по администрированию. К примеру, можно написать небольшой скрипт управления групповыми политиками доступа, который можно вызвать, передав пару параметров
- Создавать скрипты по установке программ на основе исходников
- Удаленно выполнять команды на разрешенных компьютерах (технология WinRM). Для использования требуются права администратора домена сети или HTTPS соединение\*
- PowerShell предоставляет широкие возможности для интеграции с .NET Framework, COM-объектами, WMI и ADSI

### Характеристика PowerShell как языка программирования

| Характеристика                           | Значение                                                                                                                   |
| ---------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| Типизация (статическая/динамическая)     | Динамическая                                                                                                               |
| Типизация (слабая/сильная)               | Сильная                                                                                                                    |
| Компилируемый/интерпретируемый           | Интерпретируемый                                                                                                           |
| Поддерживаемые парадигмы                 | Процедурная, ООП, функциональная (функция как параметр, конвейеры, лямбда-выражения)                                       |
| Однострочные и многострочные комментарии | Односточные: `#...`; Многострочные: `<# ... #>`                                                                            |
| Чувствительность к регистру              | ОС Windows: Нет; Linux: ?                                                                                                  |
| Назначение                               | Администрирование, автоматизация задач пользователя                                                                        |
| Рефлексия                                | Присутствует                                                                                                               |
| Естественный язык написания кода         | Английский                                                                                                                 |
| Синтаксис                                | Специфический, немного похож на JavaScript, может использоваться явная нотация типов, переменные обозначаются символом `$` |
| Точка с запятой в конце строки           | Не нужна                                                                                                                   |
| Расширения файла с кодом                 | `ps1`                                                                                                                      |
| Платформы                                | Windows, Linux, MacOS                                                                                                      |

PowerShell доступен в следующих ОС:

**Windows**: 
- 10 (сборки 1607 и выше)
- 11
- Server 2016+
- Server Core 2022
- Server Nano build 1809

**macOS**:
- 13
- 14
- 15

**Linux**:
- Alpine Linux
- Red Hat
- и другие

Команда языка Batch `color` не используется, так как для PowerShell автоматически определяемая подсветка синтаксиса

### Проявление функциональности

#### Функции как переменные

**[Использование функций как объектов первого класса](https://learn.microsoft.com/ru-ru/powershell/module/microsoft.powershell.core/about/about_functions?view=powershell-7.5&viewFallbackFrom=powershell-7.3):** Функции можно передавать как аргументы другим функциям и возвращать из функций, как и любые другие объекты

#### Конвейеры (Pipelines)

PowerShell использует [конвейеры](https://learn.microsoft.com/ru-ru/powershell/module/microsoft.powershell.core/about/about_functions?view=powershell-7.5&viewFallbackFrom=powershell-7.3) для передачи результатов одной команды (или функции) в другую. Это позволяет строить цепочки операций для обработки данных, что является распространенным приемом в функциональном программировании.

```powershell
Get-Process | Where-Object {$_.CPU -gt 1} | Sort-Object CPU -Descending
```

В этом примере `Get-Process` получает список процессов, `Where-Object` фильтрует процессы, использующие более 1\% CPU, и `Sort-Object` сортирует их по убыванию использования CPU. Каждый командлет в конвейере выполняет определенную функцию, а результаты передаются дальше по конвейеру

**[Использование CmdletBinding](https://learn.microsoft.com/ru-ru/powershell/scripting/learn/ps101/09-functions?view=powershell-7.4):** Преобразование обычной функции в расширенную функцию с помощью `CmdletBinding()` автоматически добавляет общие параметры, что упрощает создание функций, совместимых с конвейерной обработкой и следующими принципам функционального программирования

Пример расширенной функции:

```powershell
function Test-MrCmdletBinding {
    [CmdletBinding()]
    param (
        [string] $ComputerName
    )
    
    Write-Output $ComputerName
}
```

#### Лямбда-выражения

2. **Лямбда-выражения (Script Blocks):** PowerShell поддерживает лямбда-выражения, которые можно использовать для создания анонимных функций. Это особенно полезно для работы с конвейерами и командлетами, такими как `Where-Object`, `ForEach-Object` и `Select-Object`

```powershell
Get-ChildItem | Where-Object {$_.LastWriteTime -gt (Get-Date).AddDays(-7)}
```

Здесь лямбда-выражение `{$_.LastWriteTime -gt (Get-Date).AddDays(-7)}` используется для фильтрации файлов, измененных за последние 7 дней.






```powershell
Invoke-Command -ComputerName (Get-Content C:\path\to\computers.txt) -ScriptBlock
{
    Start-Process -FilePath "C:\path\to\your\program.exe" 
}
```

Объекты `-ScriptBlock` являются полностью обособленными участками кода, которые не обладают контекстом основного скрипта

#OS #OS/Windows #CMD #PowerShell